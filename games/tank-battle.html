<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¦å…‹å¯¹æˆ˜ - æœ¨å¤´çŒ«</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        /* æ¨ªå±æç¤ºæ ·å¼ */
        .landscape-warning {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #2c3e50;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            text-align: center;
            padding: 20px;
        }
        
        .landscape-warning.show {
            display: flex;
        }
        
        .landscape-warning i {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: rotateDevice 2s ease-in-out infinite;
        }
        
        @keyframes rotateDevice {
            0% { transform: rotate(0deg); }
            50% { transform: rotate(90deg); }
            100% { transform: rotate(0deg); }
        }
        
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: #f0f0f0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 10px;
            color: #333;
            overflow: hidden;
        }
        
        /* è®¾å¤‡æ£€æµ‹ç±» */
        .mobile .virtual-controls {
            display: block !important;
        }
        
        .desktop .virtual-controls {
            display: none !important;
        }
        
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: white;
            border-radius: 12px;
            padding: 15px;
            width: 100%;
            max-width: 600px;
            min-height: 80vh;
            position: relative;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            box-sizing: border-box;
            overflow-y: auto;
        }
        
        h1 {
            color: #2c3e50;
            margin: 5px 0 8px;
            text-align: center;
            font-size: 1.4rem;
            font-weight: 600;
            flex-shrink: 0;
            animation: fadeIn 0.5s ease-out;
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            width: 100%;
            margin-bottom: 8px;
            background: #f8f9fa;
            padding: 8px;
            border-radius: 8px;
            font-size: 0.85rem;
            flex-shrink: 0;
            animation: slideIn 0.4s ease-out;
        }
        
        .stat-box {
            text-align: center;
        }
        
        .stat-box .label {
            color: #7f8c8d;
            font-size: 0.75rem;
            margin-bottom: 2px;
        }
        
        .stat-box .value {
            font-weight: bold;
            color: #2c3e50;
            font-size: 1rem;
        }
        
        .game-board {
            position: relative;
            width: 100%;
            aspect-ratio: 1/1;
            min-height: 300px;
            max-height: 400px;
            border: 2px solid #3498db;
            background: linear-gradient(135deg, #4a6fa5 0%, #6b8cce 50%, #87a7d9 100%);
            margin-bottom: 10px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.1);
        }
        
        .tank {
            position: absolute;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            transform-origin: center;
            transition: transform 0.1s ease;
        }
        
        .tank.player1 {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            box-shadow: 0 0 10px rgba(231, 76, 60, 0.8);
        }
        
        .tank.player2 {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.8);
        }
        
        .tank.ai {
            background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%);
            box-shadow: 0 0 10px rgba(155, 89, 182, 0.8);
        }
        
        .tank::before {
            content: '';
            position: absolute;
            width: 20px;
            height: 8px;
            background: #333;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border-radius: 4px;
        }
        
        .tank::after {
            content: '';
            position: absolute;
            width: 8px;
            height: 20px;
            background: #333;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border-radius: 4px;
        }
        
        .turret {
            position: absolute;
            width: 25px;
            height: 6px;
            background: #333;
            top: 50%;
            left: 50%;
            transform-origin: left center;
            border-radius: 3px;
            transform: translate(0, -50%);
            transition: transform 0.1s ease-out;
        }
        
        .turret.rotating {
            animation: rotateTurret 0.2s ease-out;
        }
        
        @keyframes rotateTurret {
            0% { transform: translate(0, -50%) rotate(0deg); }
            100% { transform: translate(0, -50%) rotate(360deg); }
        }
        
        .bullet {
            position: absolute;
            width: 6px;
            height: 6px;
            background: #f39c12;
            border-radius: 50%;
            box-shadow: 0 0 5px rgba(243, 156, 18, 0.8);
        }
        
        .wall {
            position: absolute;
            background: #7f8c8d;
            border-radius: 4px;
        }
        
        .power-up {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            animation: pulse 1s infinite;
        }
        
        .power-up.speed {
            background: linear-gradient(135deg, #f1c40f 0%, #f39c12 100%);
        }
        
        .power-up.fire {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }
        
        .power-up.shield {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        }
        
        .controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            width: 100%;
            flex-shrink: 0;
            animation: slideIn 0.5s ease-out 0.2s both;
        }
        
        .buttons {
            display: flex;
            gap: 10px;
            width: 100%;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 16px;
            font-size: 0.9rem;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
            flex: 1;
            min-width: 75px;
            min-height: 44px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        
        button:hover {
            background: #2980b9;
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }
        
        button:active {
            transform: translateY(0);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }
        
        .back-home {
            position: absolute;
            top: 10px;
            left: 10px;
            background: #34495e;
            color: white;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 20;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
            text-decoration: none;
        }
        
        .back-home:hover {
            background: #2c3e50;
            transform: scale(1.15) rotate(-10deg);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        .back-home:active {
            transform: scale(1.05);
        }
        
        .game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 16px;
            border-radius: 10px;
            text-align: center;
            z-index: 100;
            display: none;
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .game-over.show {
            display: block;
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
        }
        
        .game-over h2 {
            margin-bottom: 8px;
            font-size: 1.3rem;
            animation: textPop 0.5s ease-out 0.2s both;
        }
        
        .game-over p {
            margin-bottom: 12px;
            font-size: 1.1rem;
            animation: textPop 0.5s ease-out 0.3s both;
        }
        
        .mode-selector {
            display: flex;
            gap: 8px;
            width: 100%;
            margin-bottom: 10px;
            justify-content: center;
        }
        
        .mode-btn {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background: #f8f9fa;
            color: #2c3e50;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .mode-btn.active {
            border-color: #3498db;
            background: #3498db;
            color: white;
        }
        
        .difficulty-selector {
            display: flex;
            gap: 8px;
            width: 100%;
            margin-bottom: 10px;
            justify-content: center;
        }
        
        .difficulty-btn {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background: #f8f9fa;
            color: #2c3e50;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .difficulty-btn.active {
            border-color: #3498db;
            background: #3498db;
            color: white;
        }
        
        .virtual-controls {
            display: none;
            margin-top: 15px;
            width: 100%;
            max-width: 280px;
        }
        
        .control-pad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 8px;
        }
        
        .control-btn {
            padding: 12px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1.5rem;
            min-height: 55px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            70% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); }
        }
        
        @keyframes textPop {
            0% { transform: scale(0.8); opacity: 0; }
            70% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        @keyframes explosion {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(3); opacity: 0; }
        }
        
        .explosion {
            position: absolute;
            width: 30px;
            height: 30px;
            background: radial-gradient(circle, #f39c12 0%, #e74c3c 70%, transparent 100%);
            border-radius: 50%;
            animation: explosion 0.5s ease-out forwards;
        }
        
        /* å¹³æ¿è®¾å¤‡ä¼˜åŒ– */
        @media (min-width: 481px) and (max-width: 768px) {
            .game-container {
                max-width: 420px;
                max-height: none;
                min-height: 85vh;
            }
            
            .game-board {
                min-height: 350px;
                max-height: 400px;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .stat-box .value {
                font-size: 1.1rem;
            }
            
            button {
                padding: 10px 14px;
                font-size: 0.9rem;
                min-width: 75px;
            }
            
            .virtual-controls {
                display: block;
            }
        }
        
        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 480px) {
            body {
                overflow-x: hidden;
            }
            
            .game-container {
                padding: 10px;
                min-height: 100vh;
                max-height: 100vh;
                border-radius: 0;
                padding-top: 50px;
                padding-bottom: 10px;
            }
            
            .game-board {
                min-height: 280px;
                max-height: 350px;
            }
            
            h1 {
                font-size: 1.3rem;
                margin: 8px 0 10px;
            }
            
            .stats {
                flex-wrap: wrap;
                gap: 8px;
                padding: 8px;
                margin-bottom: 10px;
            }
            
            .stat-box {
                flex: 1 1 40%;
                min-width: 80px;
            }
            
            .stat-box .label {
                font-size: 0.7rem;
            }
            
            .stat-box .value {
                font-size: 0.95rem;
            }
            
            button {
                padding: 10px 14px;
                font-size: 0.85rem;
                min-width: 70px;
            }
            
            .buttons {
                flex-wrap: wrap;
                gap: 8px;
            }
            
            .buttons button {
                flex: 1 1 40%;
                margin-bottom: 5px;
            }
            
            .virtual-controls {
                display: block;
            }
            
            .back-home {
                width: 38px;
                height: 38px;
                font-size: 18px;
            }
            
            .game-over {
                width: 90%;
                max-width: 320px;
                padding: 20px;
            }
        }
        
        /* æ¡Œé¢è®¾å¤‡ä¼˜åŒ– */
        @media (min-width: 769px) {
            .game-container {
                max-width: 500px;
                max-height: none;
                min-height: 80vh;
            }
            
            .game-board {
                min-height: 400px;
                max-height: 450px;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .stat-box .value {
                font-size: 1.2rem;
            }
            
            button {
                padding: 11px 18px;
                font-size: 0.95rem;
                min-width: 85px;
            }
        }
        
        /* æ¨ªå±æ¨¡å¼ä¼˜åŒ– */
        @media (max-height: 600px) and (orientation: landscape) {
            .game-container {
                flex-direction: row;
                flex-wrap: wrap;
                align-items: flex-start;
                padding: 10px;
                padding-top: 45px;
                min-height: 100vh;
            }
            
            h1 {
                width: 100%;
                font-size: 1.2rem;
                margin: 5px 0;
            }
            
            .stats {
                width: auto;
                margin-bottom: 8px;
                flex-wrap: nowrap;
            }
            
            .game-board {
                min-height: 250px;
                max-height: 380px;
                margin-bottom: 8px;
            }
            
            .controls {
                flex-direction: row;
                gap: 15px;
                flex: 1;
            }
            
            .virtual-controls {
                max-width: 180px;
                margin-top: 0;
            }
            
            .virtual-controls button {
                padding: 10px;
                font-size: 1.3rem;
                min-height: 50px;
            }
        }
        
        /* è®¾å¤‡ç±»å‹è¯¢é—®æ¨¡æ€æ¡†æ ·å¼ */
        .device-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .device-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .device-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        
        .device-modal.active .device-content {
            transform: scale(1);
        }
        
        .device-content h2 {
            color: #2c3e50;
            margin: 0 0 15px 0;
            font-size: 1.4rem;
            font-weight: bold;
        }
        
        .device-content p {
            color: #34495e;
            margin: 0 0 20px 0;
            line-height: 1.5;
        }
        
        .device-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .device-btn {
            padding: 12px 16px;
            font-size: 1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .device-btn.primary {
            background: #3498db;
            color: white;
        }
        
        .device-btn.primary:hover {
            background: #2980b9;
            transform: translateY(-1px);
        }
        
        .device-btn.secondary {
            background: #95a5a6;
            color: white;
        }
        
        .device-btn.secondary:hover {
            background: #7f8c8d;
            transform: translateY(-1px);
        }
        
        /* æ•™ç¨‹æ¨¡æ€æ¡†æ ·å¼ */
        .tutorial-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .tutorial-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .tutorial-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        
        .tutorial-modal.active .tutorial-content {
            transform: scale(1);
        }
        
        .tutorial-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 2px solid #3498db;
            background: #f8f9fa;
            border-radius: 12px 12px 0 0;
        }
        
        .tutorial-header h2 {
            color: #2c3e50;
            margin: 0;
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .tutorial-close {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            font-size: 1.5rem;
            font-weight: bold;
            color: #2c3e50;
            cursor: pointer;
            padding: 0;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .tutorial-close:hover {
            background: #e74c3c;
            color: white;
            border-color: #e74c3c;
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(231, 76, 60, 0.3);
        }
        
        .tutorial-close:active {
            transform: scale(0.95);
            box-shadow: 0 2px 4px rgba(231, 76, 60, 0.2);
        }
        
        .tutorial-body {
            padding: 20px;
            color: #2c3e50;
        }
        
        .tutorial-section {
            margin-bottom: 20px;
        }
        
        .tutorial-section h3 {
            color: #3498db;
            margin: 0 0 10px 0;
            font-size: 1.1rem;
            font-weight: bold;
            border-bottom: 1px solid #ecf0f1;
            padding-bottom: 5px;
        }
        
        .tutorial-section p {
            margin: 0 0 10px 0;
            line-height: 1.5;
        }
        
        .tutorial-section ul {
            margin: 0 0 10px 0;
            padding-left: 20px;
        }
        
        .tutorial-section li {
            margin-bottom: 5px;
            line-height: 1.4;
        }
        
        /* ç§»åŠ¨ç«¯æ•™ç¨‹æ¨¡æ€æ¡†ä¼˜åŒ– */
        @media (max-width: 480px) {
            .tutorial-content {
                width: 95%;
                max-height: 90vh;
            }
            
            .tutorial-header {
                padding: 15px;
            }
            
            .tutorial-header h2 {
                font-size: 1.3rem;
            }
            
            .tutorial-body {
                padding: 15px;
            }
            
            .tutorial-section h3 {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- è®¾å¤‡ç±»å‹è¯¢é—®æ¨¡æ€æ¡† -->
    <div class="device-modal" id="device-modal">
        <div class="device-content">
            <h2>è®¾å¤‡æ£€æµ‹</h2>
            <p>ä¸ºäº†è·å¾—æœ€ä½³æ¸¸æˆä½“éªŒï¼Œæˆ‘ä»¬éœ€è¦ç¡®è®¤æ‚¨çš„è®¾å¤‡ç±»å‹ã€‚</p>
            <div class="device-buttons">
                <button class="device-btn primary" id="pc-btn">æˆ‘ä½¿ç”¨çš„æ˜¯PC</button>
                <button class="device-btn primary" id="mobile-btn">æˆ‘ä½¿ç”¨çš„æ˜¯ç§»åŠ¨è®¾å¤‡</button>
                <button class="device-btn secondary" id="skip-btn">è·³è¿‡æ£€æµ‹</button>
            </div>
        </div>
    </div>
    
    <!-- æ¨ªå±æç¤º -->
    <div class="landscape-warning" id="landscape-warning">
        <i>ğŸ“±</i>
        <h2>è¯·å°†è®¾å¤‡æ¨ªå±</h2>
        <p>ä¸ºäº†è·å¾—æœ€ä½³æ¸¸æˆä½“éªŒï¼Œè¯·å°†æ‚¨çš„è®¾å¤‡æ—‹è½¬è‡³æ¨ªå±æ¨¡å¼</p>
        <button class="device-btn secondary" id="skip-landscape-btn" style="margin-top: 20px;">è·³è¿‡æ¨ªå±</button>
    </div>
    
    <a class="back-home" href="../index.html">â†</a>
    <div class="game-container">
        <h1>å¦å…‹å¯¹æˆ˜</h1>
        <div class="stats">
            <div class="stat-box">
                <div class="label">ç©å®¶1</div>
                <div class="value" id="player1-score">0</div>
            </div>
            <div class="stat-box">
                <div class="label">ç©å®¶2</div>
                <div class="value" id="player2-score">0</div>
            </div>
            <div class="stat-box">
                <div class="label">å›åˆ</div>
                <div class="value" id="round">1</div>
            </div>
        </div>
        <div class="mode-selector">
            <button class="mode-btn active" data-mode="two-player">åŒäººå¯¹æˆ˜</button>
            <button class="mode-btn" data-mode="single-player">äººæœºå¯¹æˆ˜</button>
        </div>
        <div class="difficulty-selector" id="difficulty-selector" style="display: none;">
            <button class="difficulty-btn active" data-difficulty="easy">ç®€å•</button>
            <button class="difficulty-btn" data-difficulty="medium">ä¸­ç­‰</button>
            <button class="difficulty-btn" data-difficulty="hard">å›°éš¾</button>
        </div>
        <div class="game-board" id="game-board"></div>
        <div class="controls">
            <div class="buttons">
                <button id="startBtn">å¼€å§‹æ¸¸æˆ</button>
                <button id="pauseBtn" disabled>æš‚åœ</button>
                <button id="resetBtn" disabled>é‡ç½®</button>
                <button id="tutorial-btn">ç©æ³•æ•™ç¨‹</button>
                <button id="fullscreenBtn">å…¨å±</button>
            </div>
            
            <!-- ç§»åŠ¨ç«¯è™šæ‹Ÿæ§åˆ¶ -->
            <div class="virtual-controls">
                <div class="control-pad">
                    <div></div>
                    <button class="control-btn" data-action="up">â†‘</button>
                    <div></div>
                    <button class="control-btn" data-action="left">â†</button>
                    <button class="control-btn" data-action="down">â†“</button>
                    <button class="control-btn" data-action="right">â†’</button>
                </div>
                <div style="display: flex; gap: 8px; margin-top: 8px;">
                    <button class="control-btn" data-action="fire" style="flex: 1;">å¼€ç«</button>
                    <button class="control-btn" data-action="rotate-left" style="flex: 1;">å·¦è½¬</button>
                    <button class="control-btn" data-action="rotate-right" style="flex: 1;">å³è½¬</button>
                </div>
            </div>
        </div>
        <div class="game-over" id="game-over">
            <h2>æ¸¸æˆç»“æŸ</h2>
            <p id="winner-text">ç©å®¶1è·èƒœï¼</p>
            <button id="play-again">å†ç©ä¸€æ¬¡</button>
        </div>
    </div>

    <!-- æ•™ç¨‹æ¨¡æ€æ¡† -->
    <div id="tutorial-modal" class="tutorial-modal">
        <div class="tutorial-content">
            <div class="tutorial-header">
                <h2>ç©æ³•æ•™ç¨‹</h2>
                <button class="tutorial-close">Ã—</button>
            </div>
            <div class="tutorial-body">
                <div class="tutorial-section">
                    <h3>æ¸¸æˆç›®æ ‡</h3>
                    <p>æ§åˆ¶ä½ çš„å¦å…‹å‡»è´¥å¯¹æ‰‹ï¼Œè·å¾—æ›´é«˜çš„åˆ†æ•°ï¼</p>
                </div>
                <div class="tutorial-section">
                    <h3>æ“ä½œæ–¹æ³•</h3>
                    <h4>åŒäººå¯¹æˆ˜æ¨¡å¼ï¼š</h4>
                    <ul>
                        <li>ç©å®¶1ï¼šWASDé”®æ§åˆ¶ç§»åŠ¨ï¼ŒQé”®å·¦è½¬ç‚®å¡”ï¼ŒEé”®å³è½¬ç‚®å¡”ï¼Œç©ºæ ¼å¼€ç«</li>
                        <li>ç©å®¶2ï¼šæ–¹å‘é”®æ§åˆ¶ç§»åŠ¨ï¼Œ[é”®å·¦è½¬ç‚®å¡”ï¼Œ]é”®å³è½¬ç‚®å¡”ï¼ŒEnterå¼€ç«</li>
                    </ul>
                    <h4>äººæœºå¯¹æˆ˜æ¨¡å¼ï¼š</h4>
                    <ul>
                        <li>ä½¿ç”¨WASDé”®æ§åˆ¶ç§»åŠ¨ï¼ŒQé”®å·¦è½¬ç‚®å¡”ï¼ŒEé”®å³è½¬ç‚®å¡”ï¼Œç©ºæ ¼å¼€ç«</li>
                    </ul>
                    <h4>è§¦æ‘¸æ§åˆ¶ï¼š</h4>
                    <ul>
                        <li>ä½¿ç”¨å±å¹•ä¸Šçš„è™šæ‹ŸæŒ‰é’®æ§åˆ¶å¦å…‹</li>
                        <li>æ–¹å‘é”®æ§åˆ¶ç§»åŠ¨ï¼Œå¼€ç«æŒ‰é’®å‘å°„ç‚®å¼¹</li>
                        <li>å·¦å³æ—‹è½¬æŒ‰é’®æ§åˆ¶ç‚®å¡”æ–¹å‘</li>
                    </ul>
                </div>
                <div class="tutorial-section">
                    <h3>æ¸¸æˆè§„åˆ™</h3>
                    <ul>
                        <li>å‡»ä¸­å¯¹æ‰‹å¦å…‹è·å¾—åˆ†æ•°</li>
                        <li>æ¯å›åˆé™æ—¶60ç§’ï¼Œæ—¶é—´ç»“æŸåç”Ÿå‘½å€¼é«˜çš„ä¸€æ–¹è·èƒœ</li>
                        <li>å¯ä»¥ç ´åå¢™å£è·å¾—æ›´å¥½çš„å°„å‡»ä½ç½®</li>
                        <li>æ”¶é›†é“å…·è·å¾—ç‰¹æ®Šèƒ½åŠ›ï¼š</li>
                        <li>é»„è‰²ï¼šæå‡ç§»åŠ¨é€Ÿåº¦</li>
                        <li>çº¢è‰²ï¼šæå‡ç‚®å¼¹å¨åŠ›</li>
                        <li>è“è‰²ï¼šè·å¾—ä¸´æ—¶æŠ¤ç›¾</li>
                    </ul>
                </div>
                <div class="tutorial-section">
                    <h3>éš¾åº¦è¯´æ˜</h3>
                    <ul>
                        <li>ç®€å•ï¼šAIååº”è¾ƒæ…¢ï¼Œç‚®å¼¹å¨åŠ›è¾ƒå°</li>
                        <li>ä¸­ç­‰ï¼šAIååº”é€‚ä¸­ï¼Œç‚®å¼¹å¨åŠ›æ­£å¸¸</li>
                        <li>å›°éš¾ï¼šAIååº”è¿…é€Ÿï¼Œç‚®å¼¹å¨åŠ›è¾ƒå¤§</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script src="../js/lib/hammer.min.js"></script>
    <script src="../js/logger.js"></script>
    <script src="../js/dataManager.js"></script>
    <script src="../js/scoreManager.js"></script>
    <script>
        // å¦å…‹å¯¹æˆ˜æ¸¸æˆæ ¸å¿ƒé€»è¾‘
        document.addEventListener('DOMContentLoaded', () => {
            // ==========================================
            // è®¾å¤‡æ£€æµ‹å’Œæ¨ªå±æ£€æµ‹
            // ==========================================
            
            // å…¨å±€å˜é‡
            let userDeviceType = null; // 'pc', 'mobile', or null
            let skipLandscapeCheck = false;
            
            // æ£€æµ‹è®¾å¤‡ç±»å‹
            function detectDevice() {
                const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                if (isMobile) {
                    document.body.classList.add('mobile');
                    document.body.classList.remove('desktop');
                } else {
                    document.body.classList.add('desktop');
                    document.body.classList.remove('mobile');
                }
                return isMobile;
            }
            
            // æ£€æµ‹æ¨ªå±çŠ¶æ€
            function checkOrientation() {
                const landscapeWarning = document.getElementById('landscape-warning');
                const isMobile = detectDevice();
                
                if (skipLandscapeCheck) {
                    landscapeWarning.classList.remove('show');
                    return;
                }
                
                if (isMobile && userDeviceType === 'mobile') {
                    if (window.innerHeight > window.innerWidth) {
                        // ç«–å±ï¼Œæ˜¾ç¤ºæç¤º
                        landscapeWarning.classList.add('show');
                    } else {
                        // æ¨ªå±ï¼Œéšè—æç¤º
                        landscapeWarning.classList.remove('show');
                    }
                } else {
                    // éç§»åŠ¨è®¾å¤‡æˆ–ç”¨æˆ·é€‰æ‹©äº†PCï¼Œå§‹ç»ˆéšè—æç¤º
                    landscapeWarning.classList.remove('show');
                }
            }
            
            // æ˜¾ç¤ºè®¾å¤‡ç±»å‹è¯¢é—®æ¨¡æ€æ¡†
            function showDeviceModal() {
                const deviceModal = document.getElementById('device-modal');
                deviceModal.classList.add('active');
            }
            
            // éšè—è®¾å¤‡ç±»å‹è¯¢é—®æ¨¡æ€æ¡†
            function hideDeviceModal() {
                const deviceModal = document.getElementById('device-modal');
                deviceModal.classList.remove('active');
            }
            
            // å¤„ç†è®¾å¤‡ç±»å‹é€‰æ‹©
            function handleDeviceSelection(deviceType) {
                userDeviceType = deviceType;
                hideDeviceModal();
                
                // æ ¹æ®è®¾å¤‡ç±»å‹è®¾ç½®
                if (deviceType === 'pc') {
                    // PCè®¾å¤‡ï¼Œè·³è¿‡æ¨ªå±æ£€æµ‹
                    skipLandscapeCheck = true;
                } else if (deviceType === 'mobile') {
                    // ç§»åŠ¨è®¾å¤‡ï¼Œæ£€æŸ¥æ¨ªå±
                    skipLandscapeCheck = false;
                }
                
                // åˆå§‹åŒ–æ£€æµ‹
                checkOrientation();
            }
            
            // è·³è¿‡æ¨ªå±æ£€æµ‹
            function skipLandscapeCheckFunc() {
                skipLandscapeCheck = true;
                document.getElementById('landscape-warning').classList.remove('show');
            }
            
            // åˆå§‹åŒ–è®¾å¤‡æ£€æµ‹
            detectDevice();
            checkOrientation();
            
            // ç›‘å¬çª—å£å¤§å°å˜åŒ–å’Œæ—‹è½¬
            window.addEventListener('resize', checkOrientation);
            window.addEventListener('orientationchange', checkOrientation);
            
            // è®¾å¤‡ç±»å‹è¯¢é—®æ¨¡æ€æ¡†äº‹ä»¶ç›‘å¬
            document.getElementById('pc-btn').addEventListener('click', () => {
                handleDeviceSelection('pc');
            });
            
            document.getElementById('mobile-btn').addEventListener('click', () => {
                handleDeviceSelection('mobile');
            });
            
            document.getElementById('skip-btn').addEventListener('click', () => {
                hideDeviceModal();
                // è·³è¿‡æ£€æµ‹ï¼Œä½¿ç”¨è‡ªåŠ¨æ£€æµ‹ç»“æœ
                userDeviceType = detectDevice() ? 'mobile' : 'pc';
            });
            
            // è·³è¿‡æ¨ªå±æŒ‰é’®äº‹ä»¶ç›‘å¬
            document.getElementById('skip-landscape-btn').addEventListener('click', skipLandscapeCheckFunc);
            
            // æ˜¾ç¤ºè®¾å¤‡ç±»å‹è¯¢é—®æ¨¡æ€æ¡†
            showDeviceModal();
            
            // ==========================================
            // æ¸¸æˆå¸¸é‡å’ŒçŠ¶æ€
            // ==========================================
            
            // æ¸¸æˆæ¿å°ºå¯¸
            let BOARD_WIDTH = 0;
            let BOARD_HEIGHT = 0;
            
            // æ¸¸æˆçŠ¶æ€å˜é‡
            let gameMode = 'two-player'; // æ¸¸æˆæ¨¡å¼ï¼štwo-player æˆ– single-player
            let currentDifficulty = 'easy'; // å½“å‰éš¾åº¦çº§åˆ«
            let isGameStarted = false; // æ¸¸æˆæ˜¯å¦å¼€å§‹
            let isPaused = false; // æ¸¸æˆæ˜¯å¦æš‚åœ
            let gameInterval; // æ¸¸æˆå¾ªç¯ID
            let player1Score = 0; // ç©å®¶1å¾—åˆ†
            let player2Score = 0; // ç©å®¶2å¾—åˆ†
            let round = 1; // å½“å‰å›åˆ
            let gameTime = 60; // æ¯å›åˆæ—¶é—´ï¼ˆç§’ï¼‰
            let timeLeft = gameTime; // å‰©ä½™æ—¶é—´
            let timeInterval; // æ—¶é—´è®¡æ—¶å™¨ID
            
            // å¦å…‹çŠ¶æ€
            let tanks = [];
            let bullets = [];
            let walls = [];
            let powerUps = [];
            
            // é”®ç›˜æ§åˆ¶çŠ¶æ€
            let keys = {};
            let player2Keys = {};
            
            // æ¸¸æˆæ¿å…ƒç´ 
            const gameBoard = document.getElementById('game-board');
            
            // ==========================================
            // åˆå§‹åŒ–æ¸¸æˆ
            // ==========================================
            
            function initGame() {
                // è·å–æ¸¸æˆæ¿å°ºå¯¸
                const rect = gameBoard.getBoundingClientRect();
                BOARD_WIDTH = rect.width || 400; // é»˜è®¤å®½åº¦
                BOARD_HEIGHT = rect.height || 400; // é»˜è®¤é«˜åº¦
                console.log(`æ¸¸æˆæ¿å°ºå¯¸: ${BOARD_WIDTH}x${BOARD_HEIGHT}`);
                
                // é‡ç½®æ¸¸æˆçŠ¶æ€
                player1Score = 0;
                player2Score = 0;
                round = 1;
                timeLeft = gameTime;
                isGameStarted = false;
                isPaused = false;
                
                // æ¸…ç©ºæ¸¸æˆæ¿
                clearGameBoard();
                
                // é‡ç½®UI
                document.getElementById('player1-score').textContent = player1Score;
                document.getElementById('player2-score').textContent = player2Score;
                document.getElementById('round').textContent = round;
                
                // éšè—æ¸¸æˆç»“æŸç•Œé¢
                document.getElementById('game-over').classList.remove('show');
                
                // é‡ç½®æŒ‰é’®çŠ¶æ€
                document.getElementById('startBtn').disabled = false;
                document.getElementById('pauseBtn').disabled = true;
                document.getElementById('resetBtn').disabled = true;
            }
            
            function clearGameBoard() {
                // æ¸…ç©ºæ•°ç»„
                tanks = [];
                bullets = [];
                walls = [];
                powerUps = [];
                
                // æ¸…ç©ºDOM
                gameBoard.innerHTML = '';
            }
            
            // ==========================================
            // åˆ›å»ºæ¸¸æˆå…ƒç´ 
            // ==========================================
            
            function createTanks() {
                // åˆ›å»ºç©å®¶1å¦å…‹
                const tank1 = {
                    element: document.createElement('div'),
                    x: 50,
                    y: BOARD_HEIGHT / 2,
                    width: 40,
                    height: 40,
                    direction: 0, // å¦å…‹æ–¹å‘ï¼ˆè§’åº¦ï¼‰
                    turretDirection: 0, // ç‚®å¡”æ–¹å‘ï¼ˆè§’åº¦ï¼‰
                    speed: 3,
                    bulletSpeed: 5,
                    fireRate: 300, // å¼€ç«é—´éš”ï¼ˆæ¯«ç§’ï¼‰
                    lastFire: 0,
                    health: 100,
                    score: 0,
                    isPlayer: true,
                    isAI: false,
                    name: 'player1'
                };
                
                tank1.element.className = 'tank player1';
                tank1.element.style.left = `${tank1.x}px`;
                tank1.element.style.top = `${tank1.y}px`;
                tank1.element.style.transform = `rotate(${tank1.direction}deg)`;
                
                // æ·»åŠ ç‚®å¡”
                const turret1 = document.createElement('div');
                turret1.className = 'turret';
                turret1.style.transform = `translate(0, -50%) rotate(${tank1.turretDirection}deg)`;
                tank1.element.appendChild(turret1);
                tank1.turret = turret1;
                
                gameBoard.appendChild(tank1.element);
                tanks.push(tank1);
                
                // åˆ›å»ºç©å®¶2æˆ–AIå¦å…‹
                let tank2;
                if (gameMode === 'two-player') {
                    tank2 = {
                        element: document.createElement('div'),
                        x: BOARD_WIDTH - 90,
                        y: BOARD_HEIGHT / 2,
                        width: 40,
                        height: 40,
                        direction: 180,
                        turretDirection: 180,
                        speed: 3,
                        bulletSpeed: 5,
                        fireRate: 300,
                        lastFire: 0,
                        health: 100,
                        score: 0,
                        isPlayer: true,
                        isAI: false,
                        name: 'player2'
                    };
                    
                    tank2.element.className = 'tank player2';
                } else {
                    tank2 = {
                        element: document.createElement('div'),
                        x: BOARD_WIDTH - 90,
                        y: BOARD_HEIGHT / 2,
                        width: 40,
                        height: 40,
                        direction: 180,
                        turretDirection: 180,
                        speed: 3,
                        bulletSpeed: 5,
                        fireRate: 300,
                        lastFire: 0,
                        health: 100,
                        score: 0,
                        isPlayer: false,
                        isAI: true,
                        name: 'ai',
                        difficulty: currentDifficulty,
                        target: tank1
                    };
                    
                    // æ ¹æ®éš¾åº¦è°ƒæ•´AIå±æ€§
                    switch (currentDifficulty) {
                        case 'easy':
                            tank2.speed = 2.5;
                            tank2.bulletSpeed = 4;
                            tank2.fireRate = 400;
                            break;
                        case 'medium':
                            tank2.speed = 3;
                            tank2.bulletSpeed = 5;
                            tank2.fireRate = 300;
                            break;
                        case 'hard':
                            tank2.speed = 3.5;
                            tank2.bulletSpeed = 6;
                            tank2.fireRate = 250;
                            break;
                    }
                    
                    tank2.element.className = 'tank ai';
                }
                
                tank2.element.style.left = `${tank2.x}px`;
                tank2.element.style.top = `${tank2.y}px`;
                tank2.element.style.transform = `rotate(${tank2.direction}deg)`;
                
                // æ·»åŠ ç‚®å¡”
                const turret2 = document.createElement('div');
                turret2.className = 'turret';
                turret2.style.transform = `translate(0, -50%) rotate(${tank2.turretDirection}deg)`;
                tank2.element.appendChild(turret2);
                tank2.turret = turret2;
                
                gameBoard.appendChild(tank2.element);
                tanks.push(tank2);
            }
            
            function createWalls() {
                // åˆ›å»ºéšæœºå¢™å£
                const wallCount = Math.floor(Math.random() * 5) + 5;
                
                for (let i = 0; i < wallCount; i++) {
                    const wall = {
                        element: document.createElement('div'),
                        x: Math.random() * (BOARD_WIDTH - 60) + 30,
                        y: Math.random() * (BOARD_HEIGHT - 60) + 30,
                        width: Math.random() * 30 + 20,
                        height: Math.random() * 30 + 20,
                        health: 100
                    };
                    
                    // é¿å…å¢™å£å‡ºç°åœ¨å¦å…‹åˆå§‹ä½ç½®
                    if (Math.abs(wall.x - 50) < 60 && Math.abs(wall.y - BOARD_HEIGHT / 2) < 60) continue;
                    if (Math.abs(wall.x - (BOARD_WIDTH - 90)) < 60 && Math.abs(wall.y - BOARD_HEIGHT / 2) < 60) continue;
                    
                    wall.element.className = 'wall';
                    wall.element.style.left = `${wall.x}px`;
                    wall.element.style.top = `${wall.y}px`;
                    wall.element.style.width = `${wall.width}px`;
                    wall.element.style.height = `${wall.height}px`;
                    
                    gameBoard.appendChild(wall.element);
                    walls.push(wall);
                }
            }
            
            function createPowerUps() {
                // åˆ›å»ºéšæœºé“å…·
                const powerUpTypes = ['speed', 'fire', 'shield'];
                const powerUpCount = Math.floor(Math.random() * 3) + 2;
                
                for (let i = 0; i < powerUpCount; i++) {
                    const powerUp = {
                        element: document.createElement('div'),
                        x: Math.random() * (BOARD_WIDTH - 30) + 15,
                        y: Math.random() * (BOARD_HEIGHT - 30) + 15,
                        type: powerUpTypes[Math.floor(Math.random() * powerUpTypes.length)],
                        active: true
                    };
                    
                    // é¿å…é“å…·å‡ºç°åœ¨å¦å…‹åˆå§‹ä½ç½®
                    if (Math.abs(powerUp.x - 50) < 60 && Math.abs(powerUp.y - BOARD_HEIGHT / 2) < 60) continue;
                    if (Math.abs(powerUp.x - (BOARD_WIDTH - 90)) < 60 && Math.abs(powerUp.y - BOARD_HEIGHT / 2) < 60) continue;
                    
                    powerUp.element.className = `power-up ${powerUp.type}`;
                    powerUp.element.style.left = `${powerUp.x}px`;
                    powerUp.element.style.top = `${powerUp.y}px`;
                    
                    gameBoard.appendChild(powerUp.element);
                    powerUps.push(powerUp);
                }
            }
            
            // ==========================================
            // æ¸¸æˆä¸»å¾ªç¯
            // ==========================================
            
            function gameLoop() {
                if (!isGameStarted || isPaused) return;
                
                // æ›´æ–°å¦å…‹ä½ç½®
                updateTanks();
                
                // æ›´æ–°å­å¼¹ä½ç½®
                updateBullets();
                
                // æ£€æŸ¥ç¢°æ’
                checkCollisions();
                
                // æ£€æŸ¥é“å…·æ”¶é›†
                checkPowerUps();
                
                // AIé€»è¾‘
                if (gameMode === 'single-player') {
                    updateAI();
                }
                
                // ç»§ç»­æ¸¸æˆå¾ªç¯
                gameInterval = requestAnimationFrame(gameLoop);
            }
            
            function updateTanks() {
                // æ›´æ–°ç©å®¶1å¦å…‹
                const tank1 = tanks[0];
                if (tank1.isPlayer) {
                    // ç§»åŠ¨æ§åˆ¶
                    if (keys['w']) {
                        moveTank(tank1, 0);
                    } else if (keys['s']) {
                        moveTank(tank1, 180);
                    }
                    if (keys['a']) {
                        moveTank(tank1, 270);
                    } else if (keys['d']) {
                        moveTank(tank1, 90);
                    }
                    
                    // ç‚®å¡”æ§åˆ¶
                    if (keys['q']) {
                        tank1.turretDirection -= 5;
                        tank1.turret.style.transform = `translate(0, -50%) rotate(${tank1.turretDirection}deg)`;
                        // æ·»åŠ æ—‹è½¬åŠ¨ç”»
                        tank1.turret.classList.add('rotating');
                        setTimeout(() => {
                            tank1.turret.classList.remove('rotating');
                        }, 200);
                    } else if (keys['e']) {
                        tank1.turretDirection += 5;
                        tank1.turret.style.transform = `translate(0, -50%) rotate(${tank1.turretDirection}deg)`;
                        // æ·»åŠ æ—‹è½¬åŠ¨ç”»
                        tank1.turret.classList.add('rotating');
                        setTimeout(() => {
                            tank1.turret.classList.remove('rotating');
                        }, 200);
                    }
                    
                    // å¼€ç«æ§åˆ¶
                    if (keys[' '] && Date.now() - tank1.lastFire > tank1.fireRate) {
                        fireBullet(tank1);
                        tank1.lastFire = Date.now();
                    }
                }
                
                // æ›´æ–°ç©å®¶2å¦å…‹
                const tank2 = tanks[1];
                if (tank2.isPlayer) {
                    // ç§»åŠ¨æ§åˆ¶
                    if (player2Keys['ArrowUp']) {
                        moveTank(tank2, 0);
                    } else if (player2Keys['ArrowDown']) {
                        moveTank(tank2, 180);
                    }
                    if (player2Keys['ArrowLeft']) {
                        moveTank(tank2, 270);
                    } else if (player2Keys['ArrowRight']) {
                        moveTank(tank2, 90);
                    }
                    
                    // ç‚®å¡”æ§åˆ¶
                    if (player2Keys['[']) {
                        tank2.turretDirection -= 5;
                        tank2.turret.style.transform = `translate(0, -50%) rotate(${tank2.turretDirection}deg)`;
                        // æ·»åŠ æ—‹è½¬åŠ¨ç”»
                        tank2.turret.classList.add('rotating');
                        setTimeout(() => {
                            tank2.turret.classList.remove('rotating');
                        }, 200);
                    } else if (player2Keys[']']) {
                        tank2.turretDirection += 5;
                        tank2.turret.style.transform = `translate(0, -50%) rotate(${tank2.turretDirection}deg)`;
                        // æ·»åŠ æ—‹è½¬åŠ¨ç”»
                        tank2.turret.classList.add('rotating');
                        setTimeout(() => {
                            tank2.turret.classList.remove('rotating');
                        }, 200);
                    }
                    
                    // å¼€ç«æ§åˆ¶
                    if (player2Keys['Enter'] && Date.now() - tank2.lastFire > tank2.fireRate) {
                        fireBullet(tank2);
                        tank2.lastFire = Date.now();
                    }
                }
            }
            
            function moveTank(tank, direction) {
                // æ›´æ–°å¦å…‹æ–¹å‘
                tank.direction = direction;
                tank.element.style.transform = `rotate(${tank.direction}deg)`;
                
                // è®¡ç®—ç§»åŠ¨å‘é‡
                const radians = (direction * Math.PI) / 180;
                const dx = Math.cos(radians) * tank.speed;
                const dy = Math.sin(radians) * tank.speed;
                
                // è®¡ç®—æ–°ä½ç½®
                const newX = tank.x + dx;
                const newY = tank.y + dy;
                
                // æ£€æŸ¥è¾¹ç•Œç¢°æ’
                if (newX >= 0 && newX <= BOARD_WIDTH - tank.width && newY >= 0 && newY <= BOARD_HEIGHT - tank.height) {
                    // æ£€æŸ¥å¢™å£ç¢°æ’
                    let collision = false;
                    for (const wall of walls) {
                        if (checkRectCollision(
                            newX, newY, tank.width, tank.height,
                            wall.x, wall.y, wall.width, wall.height
                        )) {
                            collision = true;
                            break;
                        }
                    }
                    
                    // æ£€æŸ¥å…¶ä»–å¦å…‹ç¢°æ’
                    for (const otherTank of tanks) {
                        if (otherTank !== tank && checkRectCollision(
                            newX, newY, tank.width, tank.height,
                            otherTank.x, otherTank.y, otherTank.width, otherTank.height
                        )) {
                            collision = true;
                            break;
                        }
                    }
                    
                    if (!collision) {
                        tank.x = newX;
                        tank.y = newY;
                        tank.element.style.left = `${tank.x}px`;
                        tank.element.style.top = `${tank.y}px`;
                    }
                }
            }
            
            function fireBullet(tank) {
                const bullet = {
                    element: document.createElement('div'),
                    x: tank.x + tank.width / 2 - 3,
                    y: tank.y + tank.height / 2 - 3,
                    direction: tank.turretDirection,
                    speed: tank.bulletSpeed,
                    damage: 20,
                    owner: tank
                };
                
                // è®¡ç®—å­å¼¹åˆå§‹ä½ç½®ï¼ˆä»ç‚®å¡”å‰ç«¯å‘å°„ï¼‰
                const radians = (tank.turretDirection * Math.PI) / 180;
                const distance = 20;
                bullet.x += Math.cos(radians) * distance;
                bullet.y += Math.sin(radians) * distance;
                
                bullet.element.className = 'bullet';
                bullet.element.style.left = `${bullet.x}px`;
                bullet.element.style.top = `${bullet.y}px`;
                
                gameBoard.appendChild(bullet.element);
                bullets.push(bullet);
            }
            
            function updateBullets() {
                for (let i = bullets.length - 1; i >= 0; i--) {
                    const bullet = bullets[i];
                    
                    // è®¡ç®—ç§»åŠ¨å‘é‡
                    const radians = (bullet.direction * Math.PI) / 180;
                    const dx = Math.cos(radians) * bullet.speed;
                    const dy = Math.sin(radians) * bullet.speed;
                    
                    // æ›´æ–°å­å¼¹ä½ç½®
                    bullet.x += dx;
                    bullet.y += dy;
                    bullet.element.style.left = `${bullet.x}px`;
                    bullet.element.style.top = `${bullet.y}px`;
                    
                    // æ£€æŸ¥è¾¹ç•Œ
                    if (bullet.x < 0 || bullet.x > BOARD_WIDTH || bullet.y < 0 || bullet.y > BOARD_HEIGHT) {
                        removeBullet(bullet, i);
                        continue;
                    }
                    
                    // æ£€æŸ¥å¢™å£ç¢°æ’
                    for (const wall of walls) {
                        if (checkRectCollision(
                            bullet.x, bullet.y, 6, 6,
                            wall.x, wall.y, wall.width, wall.height
                        )) {
                            // å¢™å£å—æŸ
                            wall.health -= bullet.damage;
                            if (wall.health <= 0) {
                                removeWall(wall);
                            }
                            removeBullet(bullet, i);
                            break;
                        }
                    }
                }
            }
            
            function checkCollisions() {
                // æ£€æŸ¥å­å¼¹ä¸å¦å…‹ç¢°æ’
                for (let i = bullets.length - 1; i >= 0; i--) {
                    const bullet = bullets[i];
                    
                    for (const tank of tanks) {
                        if (tank !== bullet.owner && checkRectCollision(
                            bullet.x, bullet.y, 6, 6,
                            tank.x, tank.y, tank.width, tank.height
                        )) {
                            // å¦å…‹å—æŸ
                            tank.health -= bullet.damage;
                            
                            // åˆ›å»ºçˆ†ç‚¸æ•ˆæœ
                            createExplosion(bullet.x, bullet.y);
                            
                            // æ£€æŸ¥å¦å…‹æ˜¯å¦è¢«æ‘§æ¯
                            if (tank.health <= 0) {
                                // å¢åŠ å‡»ä¸­è€…å¾—åˆ†
                                bullet.owner.score += 10;
                                updateScores();
                                
                                // é‡ç½®å¦å…‹ä½ç½®
                                resetTank(tank);
                            }
                            
                            removeBullet(bullet, i);
                            break;
                        }
                    }
                }
            }
            
            function checkPowerUps() {
                for (let i = powerUps.length - 1; i >= 0; i--) {
                    const powerUp = powerUps[i];
                    if (!powerUp.active) continue;
                    
                    for (const tank of tanks) {
                        if (checkRectCollision(
                            tank.x, tank.y, tank.width, tank.height,
                            powerUp.x, powerUp.y, 20, 20
                        )) {
                            // åº”ç”¨é“å…·æ•ˆæœ
                            applyPowerUp(tank, powerUp.type);
                            
                            // ç§»é™¤é“å…·
                            powerUp.active = false;
                            powerUp.element.style.display = 'none';
                            break;
                        }
                    }
                }
            }
            
            function applyPowerUp(tank, type) {
                switch (type) {
                    case 'speed':
                        tank.speed *= 1.5;
                        setTimeout(() => {
                            tank.speed /= 1.5;
                        }, 10000);
                        break;
                    case 'fire':
                        tank.bulletSpeed *= 1.3;
                        tank.fireRate *= 0.8;
                        setTimeout(() => {
                            tank.bulletSpeed /= 1.3;
                            tank.fireRate /= 0.8;
                        }, 10000);
                        break;
                    case 'shield':
                        tank.health = Math.min(tank.health + 50, 100);
                        break;
                }
            }
            
            // ==========================================
            // AIé€»è¾‘
            // ==========================================
            
            function updateAI() {
                const aiTank = tanks[1];
                if (!aiTank.isAI) return;
                
                const playerTank = tanks[0];
                
                // è®¡ç®—åˆ°ç©å®¶çš„è§’åº¦
                const dx = playerTank.x - aiTank.x;
                const dy = playerTank.y - aiTank.y;
                const angle = Math.atan2(dy, dx) * (180 / Math.PI);
                
                // æ—‹è½¬ç‚®å¡”æœå‘ç©å®¶
                aiTank.turretDirection = angle;
                aiTank.turret.style.transform = `translate(0, -50%) rotate(${aiTank.turretDirection}deg)`;
                // æ·»åŠ æ—‹è½¬åŠ¨ç”»
                aiTank.turret.classList.add('rotating');
                setTimeout(() => {
                    aiTank.turret.classList.remove('rotating');
                }, 200);
                
                // ç§»åŠ¨é€»è¾‘
                const distance = Math.sqrt(dx * dx + dy * dy);
                if (distance > 150) {
                    // é è¿‘ç©å®¶
                    moveTank(aiTank, angle);
                } else if (distance < 80) {
                    // è¿œç¦»ç©å®¶
                    moveTank(aiTank, angle + 180);
                }
                
                // å¼€ç«é€»è¾‘
                if (Date.now() - aiTank.lastFire > aiTank.fireRate) {
                    // ç®€å•çš„å°„å‡»ç²¾åº¦
                    let fireAccuracy = 0;
                    switch (currentDifficulty) {
                        case 'easy':
                            fireAccuracy = 0.6;
                            break;
                        case 'medium':
                            fireAccuracy = 0.8;
                            break;
                        case 'hard':
                            fireAccuracy = 0.95;
                            break;
                    }
                    
                    if (Math.random() < fireAccuracy) {
                        fireBullet(aiTank);
                        aiTank.lastFire = Date.now();
                    }
                }
            }
            
            // ==========================================
            // è¾…åŠ©å‡½æ•°
            // ==========================================
            
            function checkRectCollision(x1, y1, w1, h1, x2, y2, w2, h2) {
                return x1 < x2 + w2 && x1 + w1 > x2 && y1 < y2 + h2 && y1 + h1 > y2;
            }
            
            function removeBullet(bullet, index) {
                if (bullet.element && bullet.element.parentNode) {
                    bullet.element.parentNode.removeChild(bullet.element);
                }
                bullets.splice(index, 1);
            }
            
            function removeWall(wall) {
                if (wall.element && wall.element.parentNode) {
                    wall.element.parentNode.removeChild(wall.element);
                }
                const index = walls.indexOf(wall);
                if (index > -1) {
                    walls.splice(index, 1);
                }
            }
            
            function createExplosion(x, y) {
                const explosion = document.createElement('div');
                explosion.className = 'explosion';
                explosion.style.left = `${x - 15}px`;
                explosion.style.top = `${y - 15}px`;
                gameBoard.appendChild(explosion);
                
                // åŠ¨ç”»ç»“æŸåç§»é™¤
                setTimeout(() => {
                    if (explosion.parentNode) {
                        explosion.parentNode.removeChild(explosion);
                    }
                }, 500);
            }
            
            function resetTank(tank) {
                // é‡ç½®å¦å…‹ä½ç½®å’ŒçŠ¶æ€
                if (tank.name === 'player1') {
                    tank.x = 50;
                    tank.y = BOARD_HEIGHT / 2;
                    tank.direction = 0;
                    tank.turretDirection = 0;
                } else {
                    tank.x = BOARD_WIDTH - 90;
                    tank.y = BOARD_HEIGHT / 2;
                    tank.direction = 180;
                    tank.turretDirection = 180;
                }
                
                tank.health = 100;
                tank.speed = 3;
                tank.bulletSpeed = 5;
                tank.fireRate = 300;
                
                // æ›´æ–°UI
                tank.element.style.left = `${tank.x}px`;
                tank.element.style.top = `${tank.y}px`;
                tank.element.style.transform = `rotate(${tank.direction}deg)`;
                tank.turret.style.transform = `translate(0, -50%) rotate(${tank.turretDirection}deg)`;
            }
            
            function updateScores() {
                player1Score = tanks[0].score;
                player2Score = tanks[1].score;
                
                document.getElementById('player1-score').textContent = player1Score;
                document.getElementById('player2-score').textContent = player2Score;
            }
            
            function startRound() {
                // é‡æ–°è·å–æ¸¸æˆæ¿å°ºå¯¸ï¼Œç¡®ä¿å‡†ç¡®æ€§
                const rect = gameBoard.getBoundingClientRect();
                BOARD_WIDTH = rect.width || 400;
                BOARD_HEIGHT = rect.height || 400;
                console.log(`å¼€å§‹å›åˆ - æ¸¸æˆæ¿å°ºå¯¸: ${BOARD_WIDTH}x${BOARD_HEIGHT}`);
                
                // æ¸…é™¤æ¸¸æˆæ¿
                clearGameBoard();
                
                // åˆ›å»ºæ¸¸æˆå…ƒç´ 
                createTanks();
                createWalls();
                createPowerUps();
                
                // é‡ç½®æ—¶é—´
                timeLeft = gameTime;
                
                // å¼€å§‹æ¸¸æˆå¾ªç¯
                gameInterval = requestAnimationFrame(gameLoop);
                
                // å¼€å§‹æ—¶é—´è®¡æ—¶
                if (timeInterval) {
                    clearInterval(timeInterval);
                }
                timeInterval = setInterval(() => {
                    timeLeft--;
                    if (timeLeft <= 0) {
                        endRound();
                    }
                }, 1000);
            }
            
            function endRound() {
                // åœæ­¢æ¸¸æˆå¾ªç¯
                if (gameInterval) {
                    cancelAnimationFrame(gameInterval);
                    gameInterval = null;
                }
                
                // åœæ­¢æ—¶é—´è®¡æ—¶
                if (timeInterval) {
                    clearInterval(timeInterval);
                    timeInterval = null;
                }
                
                // æ£€æŸ¥å›åˆç»“æœ
                if (player1Score > player2Score) {
                    showGameOver('player1');
                } else if (player2Score > player1Score) {
                    showGameOver('player2');
                } else {
                    // å¹³å±€ï¼Œè¿›å…¥ä¸‹ä¸€å›åˆ
                    round++;
                    document.getElementById('round').textContent = round;
                    startRound();
                }
            }
            
            function showGameOver(winner) {
                const winnerText = document.getElementById('winner-text');
                if (winner === 'player1') {
                    winnerText.textContent = 'ç©å®¶1è·èƒœï¼';
                } else {
                    winnerText.textContent = gameMode === 'two-player' ? 'ç©å®¶2è·èƒœï¼' : 'AIè·èƒœï¼';
                }
                
                // è®°å½•æ¸¸æˆç»“æœ
                scoreManager.recordGameResult('tank-battle', winner, player1Score);
                
                // ä¿å­˜æ¸¸æˆè¿›åº¦
                saveGameProgress();
                
                // æ˜¾ç¤ºæ¸¸æˆç»“æŸç•Œé¢
                const gameOverElement = document.getElementById('game-over');
                gameOverElement.classList.add('show');
                
                // åœæ­¢æ¸¸æˆ
                isGameStarted = false;
            }
            
            // ==========================================
            // äº‹ä»¶ç›‘å¬å™¨
            // ==========================================
            
            // é”®ç›˜äº‹ä»¶
            document.addEventListener('keydown', (e) => {
                // ç©å®¶1æ§åˆ¶
                if (['w', 'a', 's', 'd', 'q', 'e', ' '].includes(e.key)) {
                    keys[e.key] = true;
                }
                
                // ç©å®¶2æ§åˆ¶
                if (['ArrowUp', 'ArrowLeft', 'ArrowDown', 'ArrowRight', '[', ']', 'Enter'].includes(e.key)) {
                    player2Keys[e.key] = true;
                }
            });
            
            document.addEventListener('keyup', (e) => {
                // ç©å®¶1æ§åˆ¶
                if (['w', 'a', 's', 'd', 'q', 'e', ' '].includes(e.key)) {
                    keys[e.key] = false;
                }
                
                // ç©å®¶2æ§åˆ¶
                if (['ArrowUp', 'ArrowLeft', 'ArrowDown', 'ArrowRight', '[', ']', 'Enter'].includes(e.key)) {
                    player2Keys[e.key] = false;
                }
            });
            
            // å¼€å§‹æŒ‰é’®
            document.getElementById('startBtn').addEventListener('click', () => {
                if (!isGameStarted) {
                    isGameStarted = true;
                    startRound();
                    document.getElementById('startBtn').disabled = true;
                    document.getElementById('pauseBtn').disabled = false;
                    document.getElementById('resetBtn').disabled = false;
                }
            });
            
            // æš‚åœæŒ‰é’®
            document.getElementById('pauseBtn').addEventListener('click', () => {
                isPaused = !isPaused;
                document.getElementById('pauseBtn').textContent = isPaused ? 'ç»§ç»­' : 'æš‚åœ';
                
                if (!isPaused && isGameStarted) {
                    gameInterval = requestAnimationFrame(gameLoop);
                }
            });
            
            // é‡ç½®æŒ‰é’®
            document.getElementById('resetBtn').addEventListener('click', () => {
                initGame();
            });
            
            // å†ç©ä¸€æ¬¡æŒ‰é’®
            document.getElementById('play-again').addEventListener('click', () => {
                initGame();
            });
            
            // æ¨¡å¼é€‰æ‹©
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
                    document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                    
                    // æ·»åŠ å½“å‰æ´»åŠ¨çŠ¶æ€
                    btn.classList.add('active');
                    
                    // æ›´æ–°æ¸¸æˆæ¨¡å¼
                    gameMode = btn.dataset.mode;
                    
                    // æ˜¾ç¤º/éšè—éš¾åº¦é€‰æ‹©
                    const difficultySelector = document.getElementById('difficulty-selector');
                    if (gameMode === 'single-player') {
                        difficultySelector.style.display = 'flex';
                    } else {
                        difficultySelector.style.display = 'none';
                    }
                    
                    // é‡ç½®æ¸¸æˆ
                    initGame();
                });
            });
            
            // éš¾åº¦é€‰æ‹©
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
                    document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active'));
                    
                    // æ·»åŠ å½“å‰æ´»åŠ¨çŠ¶æ€
                    btn.classList.add('active');
                    
                    // æ›´æ–°éš¾åº¦
                    currentDifficulty = btn.dataset.difficulty;
                    
                    // é‡ç½®æ¸¸æˆ
                    initGame();
                });
            });
            
            // è™šæ‹Ÿæ§åˆ¶æŒ‰é’®
            document.querySelectorAll('.control-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const action = btn.dataset.action;
                    const tank1 = tanks[0];
                    
                    switch (action) {
                        case 'up':
                            moveTank(tank1, 0);
                            break;
                        case 'down':
                            moveTank(tank1, 180);
                            break;
                        case 'left':
                            moveTank(tank1, 270);
                            break;
                        case 'right':
                            moveTank(tank1, 90);
                            break;
                        case 'fire':
                            if (Date.now() - tank1.lastFire > tank1.fireRate) {
                                fireBullet(tank1);
                                tank1.lastFire = Date.now();
                            }
                            break;
                        case 'rotate-left':
                            tank1.turretDirection -= 15;
                            tank1.turret.style.transform = `translate(0, -50%) rotate(${tank1.turretDirection}deg)`;
                            break;
                        case 'rotate-right':
                            tank1.turretDirection += 15;
                            tank1.turret.style.transform = `translate(0, -50%) rotate(${tank1.turretDirection}deg)`;
                            break;
                    }
                });
            });
            
            // æ•™ç¨‹æŒ‰é’®
            document.getElementById('tutorial-btn').addEventListener('click', () => {
                document.getElementById('tutorial-modal').classList.add('active');
            });
            
            // å…³é—­æ•™ç¨‹
            document.querySelector('.tutorial-close').addEventListener('click', () => {
                document.getElementById('tutorial-modal').classList.remove('active');
            });
            
            // ç‚¹å‡»æ•™ç¨‹å¤–éƒ¨å…³é—­
            document.getElementById('tutorial-modal').addEventListener('click', (e) => {
                if (e.target === document.getElementById('tutorial-modal')) {
                    document.getElementById('tutorial-modal').classList.remove('active');
                }
            });
            
            // å…¨å±æŒ‰é’®
            document.getElementById('fullscreenBtn').addEventListener('click', () => {
                const gameContainer = document.querySelector('.game-container');
                if (!document.fullscreenElement) {
                    if (gameContainer.requestFullscreen) {
                        gameContainer.requestFullscreen();
                    } else if (gameContainer.mozRequestFullScreen) {
                        gameContainer.mozRequestFullScreen();
                    } else if (gameContainer.webkitRequestFullscreen) {
                        gameContainer.webkitRequestFullscreen();
                    } else if (gameContainer.msRequestFullscreen) {
                        gameContainer.msRequestFullscreen();
                    }
                    document.getElementById('fullscreenBtn').textContent = 'é€€å‡ºå…¨å±';
                } else {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                    } else if (document.mozCancelFullScreen) {
                        document.mozCancelFullScreen();
                    } else if (document.webkitExitFullscreen) {
                        document.webkitExitFullscreen();
                    } else if (document.msExitFullscreen) {
                        document.msExitFullscreen();
                    }
                    document.getElementById('fullscreenBtn').textContent = 'å…¨å±';
                }
            });
            
            // å…¨å±çŠ¶æ€å˜åŒ–äº‹ä»¶
            document.addEventListener('fullscreenchange', () => {
                if (!document.fullscreenElement) {
                    document.getElementById('fullscreenBtn').textContent = 'å…¨å±';
                } else {
                    document.getElementById('fullscreenBtn').textContent = 'é€€å‡ºå…¨å±';
                }
            });
            
            // ä¿å­˜æ¸¸æˆè¿›åº¦
            function saveGameProgress() {
                const gameProgress = {
                    mode: gameMode,
                    difficulty: currentDifficulty,
                    player1Score: player1Score,
                    player2Score: player2Score,
                    round: round,
                    timestamp: Date.now()
                };
                
                try {
                    localStorage.setItem('tankBattleProgress', JSON.stringify(gameProgress));
                    console.log('æ¸¸æˆè¿›åº¦å·²ä¿å­˜');
                } catch (error) {
                    console.error('ä¿å­˜æ¸¸æˆè¿›åº¦å¤±è´¥:', error);
                }
            }
            
            // åŠ è½½æ¸¸æˆè¿›åº¦
            function loadGameProgress() {
                try {
                    const savedProgress = localStorage.getItem('tankBattleProgress');
                    if (savedProgress) {
                        const gameProgress = JSON.parse(savedProgress);
                        gameMode = gameProgress.mode;
                        currentDifficulty = gameProgress.difficulty;
                        player1Score = gameProgress.player1Score;
                        player2Score = gameProgress.player2Score;
                        round = gameProgress.round;
                        
                        // æ›´æ–°UI
                        document.getElementById('player1-score').textContent = player1Score;
                        document.getElementById('player2-score').textContent = player2Score;
                        document.getElementById('round').textContent = round;
                        
                        // æ›´æ–°æ¨¡å¼é€‰æ‹©
                        document.querySelectorAll('.mode-btn').forEach(btn => {
                            btn.classList.remove('active');
                            if (btn.dataset.mode === gameMode) {
                                btn.classList.add('active');
                            }
                        });
                        
                        // æ›´æ–°éš¾åº¦é€‰æ‹©
                        const difficultySelector = document.getElementById('difficulty-selector');
                        if (gameMode === 'single-player') {
                            difficultySelector.style.display = 'flex';
                            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                                btn.classList.remove('active');
                                if (btn.dataset.difficulty === currentDifficulty) {
                                    btn.classList.add('active');
                                }
                            });
                        } else {
                            difficultySelector.style.display = 'none';
                        }
                        
                        console.log('æ¸¸æˆè¿›åº¦å·²åŠ è½½');
                    }
                } catch (error) {
                    console.error('åŠ è½½æ¸¸æˆè¿›åº¦å¤±è´¥:', error);
                }
            }
            
            // ä¿®æ”¹initGameå‡½æ•°ä»¥åŠ è½½æ¸¸æˆè¿›åº¦
            const originalInitGame = initGame;
            initGame = function() {
                originalInitGame();
                loadGameProgress();
            };
            
            // ==========================================
            // åˆå§‹åŒ–æ¸¸æˆ
            // ==========================================
            
            initGame();
        });
    </script>
</body>
</html>