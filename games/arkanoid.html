<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÊâìÁ†ñÂùó - Êú®Â§¥Áå´</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: #f0f0f0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 15px;
            color: #333;
            overflow-x: hidden;
        }
        
        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: white;
            border-radius: 12px;
            padding: 18px;
            max-width: 100%;
            width: 100%;
            max-width: 400px;
            margin: 10px 0;
            position: relative;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            animation: containerPop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        h1 {
            color: #2c3e50;
            margin: 8px 0 12px;
            text-align: center;
            font-size: 1.6rem;
            font-weight: 600;
            animation: fadeIn 0.6s ease-out;
        }
        
        .stats {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 12px;
        }
        
        .stat-box {
            background: #e8f4f8;
            color: #2c3e50;
            padding: 8px 12px;
            border-radius: 8px;
            text-align: center;
            min-width: 80px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .stat-box h3 {
            margin: 0;
            font-size: 0.75rem;
            font-weight: 600;
            color: #34495e;
        }
        
        .stat-box p {
            margin: 2px 0 0;
            font-size: 1rem;
            font-weight: bold;
        }
        
        .game-board {
            width: 100%;
            max-width: 360px;
            height: 360px;
            margin: 8px 0 12px;
            border: 2px solid #7f8c8d;
            position: relative;
            overflow: hidden;
            background: #ecf0f1;
            border-radius: 4px;
        }
        
        #gameCanvas {
            display: block;
            width: 100%;
            height: 100%;
            background: #ecf0f1;
        }
        
        /* ÁßªÂä®Á´ØÈÄÇÈÖç */
        @media (max-width: 768px) {
            .game-container {
                padding: 12px;
                width: 100%;
                max-width: 100%;
                margin: 5px 0;
            }
            
            .game-board {
                width: 100%;
                max-width: 340px;
                height: 340px;
                margin: 8px auto;
            }
            
            #gameCanvas {
                width: 100%;
                height: 100%;
            }
            
            h1 {
                font-size: 1.4rem;
                margin: 6px 0 10px;
            }
            
            .stats {
                margin-bottom: 10px;
            }
            
            .stat-box {
                min-width: 70px;
                padding: 6px 10px;
            }
            
            .stat-box h3 {
                font-size: 0.7rem;
            }
            
            .stat-box p {
                font-size: 0.9rem;
            }
            
            .controls {
                width: 100%;
            }
            
            button {
                padding: 10px 16px;
                font-size: 0.9rem;
            }
        }
        
        @media (max-width: 480px) {
            .game-board {
                width: 100%;
                max-width: 300px;
                height: 300px;
            }
            
            h1 {
                font-size: 1.3rem;
            }
            
            .stat-box {
                min-width: 65px;
                padding: 5px 8px;
            }
            
            .stat-box h3 {
                font-size: 0.65rem;
            }
            
            .stat-box p {
                font-size: 0.85rem;
            }
            
            .gesture-hint {
                display: block !important;
            }
        }
        
        .gesture-hint {
            display: none;
        }
        
        .controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            width: 100%;
        }
        
        .buttons {
            display: flex;
            gap: 8px;
            width: 100%;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        button {
            padding: 10px 16px;
            font-size: 0.9rem;
            background: #34495e;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        button:hover {
            background: #2c3e50;
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }
        
        button:active {
            transform: translateY(0);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }
        
        .back-home {
            position: absolute;
            top: 10px;
            left: 10px;
            background: #34495e;
            color: white;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 20;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
            text-decoration: none;
        }
        
        .back-home:hover {
            background: #2c3e50;
            transform: scale(1.15) rotate(-10deg);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        .back-home:active {
            transform: scale(1.05);
        }
        
        .game-over, .game-win {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            color: white;
            font-size: 2rem;
            text-align: center;
            display: none;
        }
        
        .game-over h2, .game-win h2 {
            margin-bottom: 20px;
            font-size: 2.5rem;
            color: #e74c3c;
        }
        
        .game-win h2 {
            color: #2ecc71;
        }
        
        .game-over p, .game-win p {
            font-size: 1.2rem;
            margin-bottom: 20px;
        }
        
        /* Âä®ÁîªÂÆö‰πâ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes containerPop {
            0% { transform: scale(0.8); opacity: 0; }
            70% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1); }
        }
        
        /* ÁßªÂä®Á´Ø‰ºòÂåñ */
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            
            .game-container {
                padding: 15px;
                width: 100%;
                max-width: 100%;
                margin: 5px 0;
            }
            
            h1 {
                font-size: 1.5rem;
                margin: 6px 0 10px;
            }
            
            .stats {
                margin-bottom: 10px;
            }
            
            .stat-box {
                min-width: 70px;
                padding: 6px 10px;
            }
            
            .stat-box h3 {
                font-size: 0.7rem;
            }
            
            .stat-box p {
                font-size: 0.9rem;
            }
            
            .game-board {
                height: 300px;
                margin: 6px 0 10px;
            }
            
            button {
                padding: 9px 14px;
                font-size: 0.85rem;
            }
            
            .back-home {
                top: 6px;
                left: 6px;
                width: 26px;
                height: 26px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <a class="back-home" href="../index.html">‚Üê</a>
    <div class="game-container">
        <h1>ÊâìÁ†ñÂùó</h1>
        <div class="stats">
            <div class="stat-box">
                <h3>ÂæóÂàÜ</h3>
                <p id="score">0</p>
            </div>
            <div class="stat-box">
                <h3>ÁîüÂëΩ</h3>
                <p id="lives">3</p>
            </div>
            <div class="stat-box">
                <h3>ÂÖ≥Âç°</h3>
                <p id="level">1</p>
            </div>
            <div class="stat-box">
                <h3>ÊúÄÈ´òÂàÜ</h3>
                <p id="high-score">0</p>
            </div>
        </div>
        <div class="game-board">
            <canvas id="gameCanvas"></canvas>
            <div class="game-over" id="gameOver">
                <h2>Ê∏∏ÊàèÁªìÊùü</h2>
                <p>ÊúÄÁªàÂæóÂàÜ: <span id="finalScore">0</span></p>
                <button id="restartBtn">ÈáçÊñ∞ÂºÄÂßã</button>
            </div>
            <div class="game-win" id="gameWin">
                <h2>ÊÅ≠ÂñúÈÄöÂÖ≥</h2>
                <p>ÊúÄÁªàÂæóÂàÜ: <span id="winScore">0</span></p>
                <button id="nextLevelBtn">‰∏ã‰∏ÄÂÖ≥</button>
            </div>
        </div>
        <div class="controls">
            <div class="buttons">
                <button id="startBtn">ÂºÄÂßãÊ∏∏Êàè</button>
                <button id="pauseBtn">ÊöÇÂÅú</button>
            </div>
            <p style="margin-top: 10px; color: #7f8c8d; font-size: 0.85rem;">‰ΩøÁî® ‚Üê ‚Üí ÈîÆ„ÄÅÈº†Ê†áÊàñÊªëÂä®ÊâãÂäøÁßªÂä®Êå°Êùø</p>
        </div>
        <div class="gesture-hint" style="margin-top: 10px; color: #7f8c8d; font-size: 0.8rem; text-align: center; display: none;">
            üí° ÊèêÁ§∫ÔºöÂ∑¶Âè≥ÊªëÂä®Â±èÂπïÂèØÊéßÂà∂Êå°Êùø
        </div>
    </div>



    <script src="../js/lib/hammer.min.js"></script>
    <script src="../js/logger.js"></script>
    <script src="../js/dataManager.js"></script>
    <script src="../js/scoreManager.js"></script>
    <script src="../js/audioVibration.js"></script>
    <script src="../js/i18n.js"></script>
    <script>
        window.addEventListener('load', () => {

                                

                                // Èü≥ÊïàÂáΩÊï∞

                                function playPaddleHitSound() {
                                    if (gameAudioVibration) {
                                        gameAudioVibration.playClickSound();
                                        gameAudioVibration.vibrateShort();
                                    }
                                }

                                function playBrickHitSound() {
                                    if (gameAudioVibration) {
                                        gameAudioVibration.playSuccessSound();
                                        gameAudioVibration.vibrateMedium();
                                    }
                                }

                                function playWallHitSound() {
                                    if (gameAudioVibration) {
                                        gameAudioVibration.playErrorSound();
                                        gameAudioVibration.vibrateShort();
                                    }
                                }

                                function playWinSound() {
                                    if (gameAudioVibration) {
                                        gameAudioVibration.playWinSound();
                                        gameAudioVibration.vibrateSuccess();
                                    }
                                }

                                function playLoseSound() {
                                    if (gameAudioVibration) {
                                        gameAudioVibration.playLoseSound();
                                        gameAudioVibration.vibrateFailure();
                                    }
                                }

                                

                                // Ëé∑ÂèñDOMÂÖÉÁ¥†

                                const canvas = document.getElementById('gameCanvas');

                                const ctx = canvas.getContext('2d');

                                const scoreDisplay = document.getElementById('score');

                                const livesDisplay = document.getElementById('lives');

                                const levelDisplay = document.getElementById('level');

                                const highScoreDisplay = document.getElementById('high-score');

                                const finalScoreDisplay = document.getElementById('finalScore');

                                const winScoreDisplay = document.getElementById('winScore');

                                const gameOverScreen = document.getElementById('gameOver');

                                const gameWinScreen = document.getElementById('gameWin');

                                const startBtn = document.getElementById('startBtn');

                                const pauseBtn = document.getElementById('pauseBtn');

                                const restartBtn = document.getElementById('restartBtn');

                                const nextLevelBtn = document.getElementById('nextLevelBtn');

                                

                                // Ê∏∏ÊàèÁä∂ÊÄÅ

                                let score = 0;

                                let lives = 3;

                                let level = 1;

                                let gameRunning = false;

                                let gamePaused = false;

                                let animationId = null;

                                let highScore = 0; // ÂàùÂßãÂåñ‰∏∫0

                                            // ÂºÇÊ≠•Âä†ËΩΩÈ´òÂàÜ

                                                                    scoreManager.getHighScore('arkanoid', 0).then(loadedHighScore => {

                                                                        highScore = loadedHighScore;

                                                                        highScoreDisplay.textContent = highScore;

                                                                    });

                                

                                // ÂàùÂßãÂåñÁîªÂ∏É

                                

                                                                function initCanvasSize() {

                                

                                                                    const gameBoard = document.querySelector('.game-board');

                                

                                                                    const containerWidth = gameBoard.clientWidth;

                                

                                                                    const containerHeight = gameBoard.clientHeight;

                                

                                

                                

                                                                    canvas.width = containerWidth;

                                

                                                                    canvas.height = containerHeight;

                                

                                                                }

                                

                                

                                

                                                                initCanvasSize();

                                

                                

                                

                                                                // Ê∑ªÂä†roundRectÊñπÊ≥ïÊîØÊåÅ

                                

                                                                if (CanvasRenderingContext2D.prototype.roundRect === undefined) {

                                

                                                                    CanvasRenderingContext2D.prototype.roundRect = function(x, y, width, height, radius) {

                                

                                                                        if (width < 2 * radius) radius = width / 2;

                                

                                                                        if (height < 2 * radius) radius = height / 2;

                                

                                

                                

                                                                        this.beginPath();

                                

                                                                        this.moveTo(x + radius, y);

                                

                                                                        this.lineTo(x + width - radius, y);

                                

                                                                        this.quadraticCurveTo(x + width, y, x + width, y + radius);

                                

                                                                        this.lineTo(x + width, y + height - radius);

                                

                                                                        this.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);

                                

                                                                        this.lineTo(x + radius, y + height);

                                

                                                                        this.quadraticCurveTo(x, y + height, x, y + height - radius);

                                

                                                                        this.lineTo(x, y + radius);

                                

                                                                        this.quadraticCurveTo(x, y, x + radius, y);

                                

                                                                        this.closePath();

                                

                                                                        return this;

                                

                                                                    };

                                

                                                                }

                                

                                

                                

                                                                // Ê∏∏ÊàèÂØπË±°ÔºàÂú®canvasÂàùÂßãÂåñÂêéÂàõÂª∫Ôºâ

                                

                                                                let ball;

                                

                                                                let paddle;

                                

                                

                                

                                                                function initGameObjects() {

                                

                                                                    ball = {

                                

                                                                        x: canvas.width / 2,

                                

                                                                        y: canvas.height - 50,

                                

                                                                        radius: 8,

                                

                                                                        dx: 4,

                                

                                                                        dy: -4,

                                

                                                                        speed: 4,

                                

                                                                        reset: function() {

                                

                                                                            this.x = canvas.width / 2;

                                

                                                                            this.y = canvas.height - 50;

                                

                                                                            this.dx = 4 * (Math.random() > 0.5 ? 1 : -1);

                                

                                                                            this.dy = -4;

                                

                                                                        }

                                

                                                                    };

                                

                                

                                

                                                                    paddle = {

                                

                                                                        width: Math.min(80, canvas.width * 0.2),

                                

                                                                        height: 12,

                                

                                                                        x: (canvas.width - Math.min(80, canvas.width * 0.2)) / 2,

                                

                                                                        speed: 8,

                                

                                                                        moveLeft: function() {

                                

                                                                            this.x = Math.max(0, this.x - this.speed);

                                

                                                                        },

                                

                                                                        moveRight: function() {

                                

                                                                            this.x = Math.min(canvas.width - this.width, this.x + this.speed);

                                

                                                                        }

                                

                                                                    };

                                

                                                                }

                                

                                // Á†ñÂùóÁ≥ªÁªü

                                const brick = {

                                    rowCount: 5,

                                    colCount: 8,

                                    width: 0,

                                    height: 20,

                                    padding: 4,

                                    offsetTop: 50,

                                    offsetLeft: 10,

                                    init: function() {

                                        this.width = (canvas.width - (this.offsetLeft * 2) - (this.padding * (this.colCount + 1))) / this.colCount;

                                        this.height = Math.min(20, (canvas.height * 0.25) / this.rowCount);

                                    },

                                    rows: []

                                };

                                

                                // ÂàùÂßãÂåñÁ†ñÂùó

                                function initBricks() {

                                    brick.init();

                                    brick.rows = [];

                                    

                                    for (let r = 0; r < brick.rowCount; r++) {

                                        brick.rows[r] = [];

                                        for (let c = 0; c < brick.colCount; c++) {

                                            brick.rows[r][c] = {

                                                x: c * (brick.width + brick.padding) + brick.offsetLeft,

                                                y: r * (brick.height + brick.padding) + brick.offsetTop,

                                                status: true,

                                                color: getBrickColor(r)

                                            };

                                        }

                                    }

                                }

                                

                                // Ëé∑ÂèñÁ†ñÂùóÈ¢úËâ≤

                                function getBrickColor(row) {

                                    const colors = [

                                        "#e74c3c", // Á∫¢Ëâ≤

                                        "#e67e22", // Ê©ôËâ≤

                                        "#f1c40f", // ÈªÑËâ≤

                                        "#2ecc71", // ÁªøËâ≤

                                        "#3498db"  // ËìùËâ≤

                                    ];

                                    return colors[row % colors.length];

                                }

                                

                                // ÁªòÂà∂ÂáΩÊï∞

                                function drawBall() {
                                    // ÂàõÂª∫Â∏¶ÊúâÂÖâÊ≥ΩÊïàÊûúÁöÑÁêÉ
                                    ctx.beginPath();
                                    ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
                                    
                                    // ÂàõÂª∫ÂæÑÂêëÊ∏êÂèò
                                    const gradient = ctx.createRadialGradient(
                                        ball.x - ball.radius/3, ball.y - ball.radius/3, 1,
                                        ball.x, ball.y, ball.radius
                                    );
                                    gradient.addColorStop(0, "#ffffff");
                                    gradient.addColorStop(0.3, "#e74c3c");
                                    gradient.addColorStop(1, "#c0392b");
                                    
                                    ctx.fillStyle = gradient;
                                    ctx.fill();
                                    
                                    // Ê∑ªÂä†È´òÂÖâÊïàÊûú
                                    ctx.beginPath();
                                    ctx.arc(
                                        ball.x - ball.radius/3, 
                                        ball.y - ball.radius/3, 
                                        ball.radius/3, 
                                        0, 
                                        Math.PI * 2
                                    );
                                    ctx.fillStyle = "rgba(255, 255, 255, 0.7)";
                                    ctx.fill();
                                    
                                    ctx.closePath();
                                    
                                    // Ê∑ªÂä†ËΩ®ËøπÊïàÊûúÔºàÂèØÈÄâÔºâ
                                    if (gameRunning && !gamePaused) {
                                        ctx.beginPath();
                                        ctx.arc(ball.x - ball.dx * 0.3, ball.y - ball.dy * 0.3, ball.radius * 0.7, 0, Math.PI * 2);
                                        ctx.fillStyle = "rgba(231, 76, 60, 0.3)";
                                        ctx.fill();
                                        ctx.closePath();
                                    }
                                }

                                

                                function drawPaddle() {
                                    // ÁªòÂà∂Êå°Êùø‰∏ª‰Ωì
                                    ctx.beginPath();
                                    ctx.roundRect(paddle.x, canvas.height - paddle.height, paddle.width, paddle.height, 5);
                                    
                                    // ÂàõÂª∫Á∫øÊÄßÊ∏êÂèò
                                    const gradient = ctx.createLinearGradient(
                                        paddle.x, canvas.height - paddle.height,
                                        paddle.x, canvas.height
                                    );
                                    gradient.addColorStop(0, "#3498db");
                                    gradient.addColorStop(1, "#2980b9");
                                    
                                    ctx.fillStyle = gradient;
                                    ctx.fill();
                                    
                                    // Ê∑ªÂä†ËæπÊ°Ü
                                    ctx.strokeStyle = "#1f618d";
                                    ctx.lineWidth = 2;
                                    ctx.stroke();
                                    
                                    // Ê∑ªÂä†È´òÂÖâÊïàÊûú
                                    ctx.beginPath();
                                    ctx.roundRect(paddle.x + 2, canvas.height - paddle.height + 2, paddle.width - 4, 4, 2);
                                    ctx.fillStyle = "rgba(255, 255, 255, 0.4)";
                                    ctx.fill();
                                    
                                    ctx.closePath();
                                }

                                

                                // Á†ñÂùóÁ†¥Á¢éÂä®ÁîªÁ≥ªÁªü
                                const brickParticles = [];

                                function createBrickParticles(x, y, color) {
                                    for (let i = 0; i < 8; i++) {
                                        brickParticles.push({
                                            x: x,
                                            y: y,
                                            size: Math.random() * 4 + 2,
                                            speedX: (Math.random() - 0.5) * 6,
                                            speedY: (Math.random() - 0.5) * 6,
                                            color: color,
                                            life: 20
                                        });
                                    }
                                }

                                function updateBrickParticles() {
                                    for (let i = brickParticles.length - 1; i >= 0; i--) {
                                        const p = brickParticles[i];
                                        p.x += p.speedX;
                                        p.y += p.speedY;
                                        p.life--;
                                        
                                        if (p.life <= 0) {
                                            brickParticles.splice(i, 1);
                                        }
                                    }
                                }

                                function drawBrickParticles() {
                                    for (const p of brickParticles) {
                                        ctx.globalAlpha = p.life / 20;
                                        ctx.fillStyle = p.color;
                                        ctx.beginPath();
                                        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                                        ctx.fill();
                                    }
                                    ctx.globalAlpha = 1.0;
                                }

                                function drawBricks() {
                                    for (let r = 0; r < brick.rowCount; r++) {
                                        for (let c = 0; c < brick.colCount; c++) {
                                            const b = brick.rows[r][c];
                                            if (b.status) {
                                                ctx.beginPath();
                                                ctx.roundRect(b.x, b.y, brick.width, brick.height, 3);
                                                ctx.fillStyle = b.color;
                                                ctx.fill();
                                                ctx.strokeStyle = "#2c3e50";
                                                ctx.lineWidth = 1;
                                                ctx.stroke();
                                                ctx.closePath();
                                                
                                                // Ê∑ªÂä†Á†ñÂùóÂÖâÊ≥ΩÊïàÊûú
                                                ctx.beginPath();
                                                ctx.roundRect(b.x + 2, b.y + 2, brick.width - 4, 4, 2);
                                                ctx.fillStyle = "rgba(255, 255, 255, 0.3)";
                                                ctx.fill();
                                                ctx.closePath();
                                            }
                                        }
                                    }
                                }

                        

                                                        // Á¢∞ÊíûÊ£ÄÊµã

                                                        function detectCollisions() {
                                                            // Á†ñÂùóÁ¢∞Êíû
                                                            for (let r = 0; r < brick.rowCount; r++) {
                                                                for (let c = 0; c < brick.colCount; c++) {
                                                                    const b = brick.rows[r][c];
                                                                    if (b.status) {
                                                                        if (
                                                                            ball.x + ball.radius > b.x && 
                                                                            ball.x - ball.radius < b.x + brick.width && 
                                                                            ball.y + ball.radius > b.y && 
                                                                            ball.y - ball.radius < b.y + brick.height
                                                                        ) {
                                                                            b.status = false;
                                                                            // Ê†πÊçÆÁêÉ‰∏éÁ†ñÂùóÁöÑÁ¢∞ÊíûÊñπÂêëË∞ÉÊï¥ÂèçÂºπÊñπÂêë
                                                                            const ballCenterX = ball.x;
                                                                            const ballCenterY = ball.y;
                                                                            const brickCenterX = b.x + brick.width / 2;
                                                                            const brickCenterY = b.y + brick.height / 2;
                                                                            
                                                                            // ËÆ°ÁÆóÁêÉÂøÉÂà∞Á†ñÂùó‰∏≠ÂøÉÁöÑÂêëÈáè
                                                                            const dx = ballCenterX - brickCenterX;
                                                                            const dy = ballCenterY - brickCenterY;
                                                                            
                                                                            // Ê†πÊçÆÁ¢∞ÊíûÊñπÂêëË∞ÉÊï¥ÂèçÂºπ
                                                                            if (Math.abs(dx) > Math.abs(dy)) {
                                                                                // Ê∞¥Âπ≥ÊñπÂêëÁ¢∞Êíû
                                                                                ball.dx = -ball.dx;
                                                                            } else {
                                                                                // ÂûÇÁõ¥ÊñπÂêëÁ¢∞Êíû
                                                                                ball.dy = -ball.dy;
                                                                            }
                                                                            
                                                                            score += 10;
                                                                            scoreDisplay.textContent = score;
                                                                            
                                                                            // Ê£ÄÊü•È´òÂàÜËÆ∞ÂΩï
                                                                                                    if (score > highScore) {
                                                                                                        highScore = score;
                                                                                                        scoreManager.updateHighScore('arkanoid', highScore);
                                                                                                        highScoreDisplay.textContent = highScore;
                                                                                                    }                                                                            
                                                                            // ÂàõÂª∫Á†¥Á¢éÁ≤íÂ≠êÊïàÊûú
                                                                            createBrickParticles(
                                                                                b.x + brick.width / 2, 
                                                                                b.y + brick.height / 2, 
                                                                                b.color
                                                                            );
                                                                            
                                                                            playBrickHitSound();
                                                                            
                                                                            // Ê£ÄÊü•ÊòØÂê¶ÊâÄÊúâÁ†ñÂùóÈÉΩË¢´Ê∏ÖÈô§
                                                                            let allBricksBroken = true;
                                                                            for (let r2 = 0; r2 < brick.rowCount; r2++) {
                                                                                for (let c2 = 0; c2 < brick.colCount; c2++) {
                                                                                    if (brick.rows[r2][c2].status) {
                                                                                        allBricksBroken = false;
                                                                                        break;
                                                                                    }
                                                                                }
                                                                                if (!allBricksBroken) break;
                                                                            }
                                                                            
                                                                            if (allBricksBroken) {
                                                                                levelUp();
                                                                            }
                                                                            
                                                                            return true; // Á†ñÂùóÁ¢∞ÊíûÂ∑≤Â§ÑÁêÜ
                                                                        }
                                                                    }
                                                                }
                                                            }

                        

                                                            

                        

                                                            // Êå°ÊùøÁ¢∞Êíû

                        

                                                            if (

                        

                                                                ball.y + ball.radius > canvas.height - paddle.height &&

                        

                                                                ball.y - ball.radius < canvas.height &&

                        

                                                                ball.x + ball.radius > paddle.x &&

                        

                                                                ball.x - ball.radius < paddle.x + paddle.width

                        

                                                            ) {

                        

                                                                // Ê†πÊçÆÁêÉÂáª‰∏≠Êå°ÊùøÁöÑ‰ΩçÁΩÆË∞ÉÊï¥ÂèçÂºπËßíÂ∫¶

                        

                                                                const hitPos = (ball.x - (paddle.x + paddle.width / 2)) / (paddle.width / 2);

                        

                                                                ball.dx = hitPos * 5; // Ê†πÊçÆÂáª‰∏≠‰ΩçÁΩÆË∞ÉÊï¥Ê∞¥Âπ≥ÈÄüÂ∫¶

                        

                                                                ball.dy = -Math.abs(ball.dy); // Á°Æ‰øùÁêÉÂêë‰∏äÂèçÂºπ

                        

                                                                playPaddleHitSound();

                        

                                                                return true; // Êå°ÊùøÁ¢∞ÊíûÂ∑≤Â§ÑÁêÜ

                        

                                                            }

                        

                                                            

                        

                                                            // ËæπÁïåÁ¢∞Êíû

                        

                                                            // Â∑¶Âè≥ËæπÁïå

                        

                                                            if (ball.x + ball.radius > canvas.width || ball.x - ball.radius < 0) {

                        

                                                                ball.dx = -ball.dx;

                        

                                                                playWallHitSound();

                        

                                                            }

                        

                                                            

                        

                                                            // ‰∏äËæπÁïå

                        

                                                            if (ball.y - ball.radius < 0) {

                        

                                                                ball.dy = -ball.dy;

                        

                                                                playWallHitSound();

                        

                                                            }

                        

                                                            

                        

                                                            // ‰∏ãËæπÁïåÔºàÂ§±ÂéªÁîüÂëΩÂÄºÔºâ

                        

                                                            if (ball.y + ball.radius > canvas.height) {

                        

                                                                lives--;

                        

                                                                livesDisplay.textContent = lives;

                        

                                                                

                        

                                                                if (lives <= 0) {

                        

                                                                    gameOver();

                        

                                                                } else {

                        

                                                                    resetBall();

                        

                                                                }

                        

                                                            }

                        

                                                            

                        

                                                            return false; // Ê≤°ÊúâÁ†ñÂùóÊàñÊå°ÊùøÁ¢∞Êíû

                        

                                                        }

                        

                        // ÈáçÁΩÆÁêÉ

                        function resetBall() {

                            ball.reset();

                        }

                        

                        // Ê∏∏ÊàèÂæ™ÁéØ
                        function gameLoop() {
                            if (!gameRunning || gamePaused) {
                                animationId = requestAnimationFrame(gameLoop);
                                return;
                            }
                            
                            // Ê∏ÖÁ©∫ÁîªÂ∏É
                            ctx.clearRect(0, 0, canvas.width, canvas.height);
                            
                            // ÁßªÂä®ÁêÉ
                            ball.x += ball.dx;
                            ball.y += ball.dy;
                            
                            // Ê£ÄÊµãÁ¢∞Êíû
                            detectCollisions();
                            
                            // Êõ¥Êñ∞Á≤íÂ≠êÁ≥ªÁªü
                            updateBrickParticles();
                            
                            // ÁªòÂà∂Ê∏∏ÊàèÂÖÉÁ¥†
                            drawBricks();
                            drawBrickParticles(); // ÁªòÂà∂Á†¥Á¢éÁ≤íÂ≠ê
                            drawBall();
                            drawPaddle();
                            
                            // ÊöÇÂÅúÊòæÁ§∫
                            if (gamePaused) {
                                ctx.fillStyle = 'rgba(0, 0, 0, 0.6)';
                                ctx.fillRect(0, 0, canvas.width, canvas.height);
                                ctx.font = 'bold 30px Arial';
                                ctx.fillStyle = 'white';
                                ctx.textAlign = 'center';
                                ctx.fillText('Ê∏∏ÊàèÊöÇÂÅú', canvas.width/2, canvas.height/2);
                            }
                            
                            animationId = requestAnimationFrame(gameLoop);
                        }

                        

                        // Ê∏∏ÊàèÁä∂ÊÄÅÂáΩÊï∞

                        function startGame() {

                            if (gameRunning) {

                                resetGame();

                                return;

                            }

                            

                            gameRunning = true;

                            gamePaused = false;

                            startBtn.textContent = "ÈáçÊñ∞ÂºÄÂßã";

                            pauseBtn.textContent = "ÊöÇÂÅú";

                            gameLoop();

                        }

                        

                        function togglePause() {

                            if (!gameRunning) return;

                            

                            gamePaused = !gamePaused;

                            pauseBtn.textContent = gamePaused ? "ÁªßÁª≠" : "ÊöÇÂÅú";

                        }

                        

                        function gameOver() {

                            gameRunning = false;

                            cancelAnimationFrame(animationId);

                            finalScoreDisplay.textContent = score;

                            gameOverScreen.style.display = "flex";

                            // ËÆ∞ÂΩïÊ∏∏ÊàèÁªìÊûú
                            scoreManager.recordGameResult('arkanoid', 'loss', score);

                            playLoseSound();

                        }

                        

                        function levelUp() {

                            gameRunning = false;

                            cancelAnimationFrame(animationId);

                            winScoreDisplay.textContent = score;

                            gameWinScreen.style.display = "flex";

                            // ËÆ∞ÂΩïÊ∏∏ÊàèÁªìÊûú
                            scoreManager.recordGameResult('arkanoid', 'win', score);

                            playWinSound();

                        }

                        

                        function nextLevel() {

                            level++;

                            levelDisplay.textContent = level;

                            initBricks();

                            resetBall();

                            gameWinScreen.style.display = "none";

                            gameRunning = true;

                            gamePaused = false;

                            gameLoop();

                        }

                        

                        function resetGame() {

                            if (animationId) {

                                cancelAnimationFrame(animationId);

                            }

                            

                            // ÈáçÁΩÆÊ∏∏ÊàèÁä∂ÊÄÅ

                            score = 0;

                            lives = 3;

                            level = 1;

                            

                            scoreDisplay.textContent = score;

                            livesDisplay.textContent = lives;

                            levelDisplay.textContent = level;

                            

                            initBricks();

                            resetBall();

                            

                            gameOverScreen.style.display = "none";

                            gameWinScreen.style.display = "none";

                            

                            gameRunning = false;

                            gamePaused = false;

                            startBtn.textContent = "ÂºÄÂßãÊ∏∏Êàè";

                            pauseBtn.textContent = "ÊöÇÂÅú";

                            

                            // ÈáçÊñ∞ÁªòÂà∂ÂàùÂßãÁîªÈù¢

                            ctx.clearRect(0, 0, canvas.width, canvas.height);

                            drawBricks();

                            drawBall();

                            drawPaddle();

                        }

                        

                        // ‰∫ã‰ª∂ÁõëÂê¨Âô®

                        startBtn.addEventListener('click', startGame);

                        pauseBtn.addEventListener('click', togglePause);

                        restartBtn.addEventListener('click', () => {

                            gameOverScreen.style.display = "none";

                            resetGame();

                        });

                        nextLevelBtn.addEventListener('click', nextLevel);

                        

                        // ÈîÆÁõòÊéßÂà∂

                        document.addEventListener('keydown', (e) => {

                            if (!gameRunning || gamePaused) return;

                            

                            if (e.key === 'ArrowLeft' || e.key === 'a' || e.key === 'A') {

                                paddle.moveLeft();

                            } else if (e.key === 'ArrowRight' || e.key === 'd' || e.key === 'D') {

                                paddle.moveRight();

                            } else if (e.key === ' ') {  // Á©∫Ê†ºÈîÆÊöÇÂÅú

                                togglePause();

                            }

                        });

                        

                        // Èº†Ê†áÊéßÂà∂

                        canvas.addEventListener('mousemove', (e) => {

                            if (!gameRunning || gamePaused) return;

                            

                            const rect = canvas.getBoundingClientRect();

                            const relativeX = e.clientX - rect.left;

                            paddle.x = Math.max(0, Math.min(relativeX - paddle.width / 2, canvas.width - paddle.width));

                        });

                        

                        // Ëß¶Êë∏ÊéßÂà∂
                        canvas.addEventListener('touchmove', (e) => {
                            if (!gameRunning || gamePaused) return;
                            
                            e.preventDefault();
                            const rect = canvas.getBoundingClientRect();
                            const relativeX = e.touches[0].clientX - rect.left;
                            paddle.x = Math.max(0, Math.min(relativeX - paddle.width / 2, canvas.width - paddle.width));
                        }, { passive: false });
                        
                        // Ëß¶Êë∏ÂºÄÂßã‰∫ã‰ª∂ÔºåÁî®‰∫éÁßªÂä®Á´Ø‰ΩìÈ™å‰ºòÂåñ
                        canvas.addEventListener('touchstart', (e) => {
                            if (!gameRunning) {
                                startGame(); // Â¶ÇÊûúÊ∏∏ÊàèÊú™ÂºÄÂßãÔºåËß¶Êë∏ÂºÄÂßãÊó∂Ëá™Âä®ÂºÄÂßãÊ∏∏Êàè
                            }
                        });

                        

                                        // Hammer.js ÊâãÂäøÊéßÂà∂

                        

                                        const hammerManager = new Hammer.Manager(canvas);

                        

                                        hammerManager.add(new Hammer.Swipe({ direction: Hammer.DIRECTION_HORIZONTAL, threshold: 10, velocity: 0.3 }));

                        

                                        

                        

                                        hammerManager.on('swipeleft', (e) => {

                        

                                            if (gameRunning && !gamePaused) {

                        

                                                paddle.moveLeft();

                        

                                            }

                        

                                            e.preventDefault();

                        

                                        });

                        

                                        

                        

                                        hammerManager.on('swiperight', (e) => {

                        

                                            if (gameRunning && !gamePaused) {

                        

                                                paddle.moveRight();

                        

                                            }

                        

                                            e.preventDefault();

                        

                                        });

                        

                        // Á™óÂè£Â§ßÂ∞èË∞ÉÊï¥

                        window.addEventListener('resize', () => {

                            initCanvasSize();

                            initGameObjects(); // ÈáçÊñ∞ÂàùÂßãÂåñÊ∏∏ÊàèÂØπË±°

                            initBricks(); // ÈáçÊñ∞ÂàùÂßãÂåñÁ†ñÂùóÂ∏ÉÂ±Ä

                            resetBall();

                            

                            // ÈáçÊñ∞ÁªòÂà∂ÂàùÂßãÁîªÈù¢

                            if (!gameRunning) {

                                ctx.clearRect(0, 0, canvas.width, canvas.height);

                                drawBricks();

                                drawBall();

                                drawPaddle();

                            }

                        });

                        

                        // ÂàùÂßãÂåñÊ∏∏Êàè

                        initGameObjects();

                        initBricks();

                        resetBall();

                        ctx.clearRect(0, 0, canvas.width, canvas.height);

                        drawBricks();

                        drawBall();

                        drawPaddle();

        });

                </script>
</body>
</html>