<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>木头猫 - 小游戏合集</title>
    <!-- PWA Meta Tags -->
    <meta name="description" content="A collection of classic games with modern web technologies">
    <meta name="keywords" content="games, classic games, web games, woodcat, tetris, snake, minesweeper, 2048">
    <meta name="theme-color" content="#3498db">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Woodcat Games">
    <meta name="application-name" content="Woodcat Game Collection">
    <meta name="msapplication-TileColor" content="#3498db">
    <meta name="msapplication-config" content="/browserconfig.xml">
    <!-- Favicon and Icons -->
    <link rel="icon" type="image/x-icon" href="/icons/favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <link rel="mask-icon" href="/icons/favicon.svg" color="#3498db">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="preload" href="css/style.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&family=Noto+Sans:wght@300;400;500;700&display=swap" rel="stylesheet">
    <noscript><link rel="stylesheet" href="css/style.css"></noscript>
</head>
<body>
    <div class="container">
        <!-- 头部 -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <h1 data-i18n="site.title">木头猫</h1>
                    <p class="slogan" data-i18n="site.slogan">发现有趣的小游戏</p>
                </div>
                <div class="nav-container">
                    <nav class="nav">
                        <ul>
                            <li><a href="#" class="active" data-i18n="nav.home">首页</a></li>
                            <li><a href="#games" data-i18n="nav.games">游戏</a></li>
                            <li><a href="leaderboard.html" data-i18n="nav.leaderboard">排行榜</a></li>
                            <li class="lang-switcher">
                                <button class="lang-btn" id="langToggle" title="Switch Language">
                                    <span id="langIcon">🌐</span>
                                    <span id="langText">RU</span>
                                </button>
                            </li>
                        </ul>
                    </nav>
                    <div class="mobile-menu-btn">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            </div>
        </header>

        <!-- 主要内容 -->
        <main class="main">
            <section class="hero">
                <h2 data-i18n="hero.title">欢迎来到木头猫游戏世界</h2>
                <p data-i18n="hero.description">在这里，您可以找到各种经典有趣的小游戏，随时随地享受游戏的乐趣。</p>
                <div class="cta-buttons">
                    <button class="btn-primary" onclick="startRandomGame()" data-i18n="hero.startGame">开始游戏</button>
                </div>
            </section>

            <section class="games-section" id="games">
                <h3 data-i18n="section.games">精选游戏</h3>
                <div class="games-grid">
                    <div class="game-card" data-game="tetris" role="button" tabindex="0">
                        <div class="game-icon">🧩</div>
                        <h4 data-i18n="game.tetris">俄罗斯方块</h4>
                        <p data-i18n="game.tetris.desc">经典益智游戏</p>
                        <div class="game-meta">
                            <span class="difficulty easy" data-i18n="difficulty.easy">简单</span>
                            <span class="players" data-i18n="players.1">1人</span>
                        </div>
                    </div>
                    <div class="game-card" data-game="snake" role="button" tabindex="0">
                        <div class="game-icon">🐍</div>
                        <h4 data-i18n="game.snake">贪吃蛇</h4>
                        <p data-i18n="game.snake.desc">怀旧经典玩法</p>
                        <div class="game-meta">
                            <span class="difficulty medium" data-i18n="difficulty.medium">中等</span>
                            <span class="players" data-i18n="players.1">1人</span>
                        </div>
                    </div>
                    <div class="game-card" data-game="minesweeper" role="button" tabindex="0">
                        <div class="game-icon">💣</div>
                        <h4 data-i18n="game.minesweeper">扫雷</h4>
                        <p data-i18n="game.minesweeper.desc">挑战逻辑思维</p>
                        <div class="game-meta">
                            <span class="difficulty hard" data-i18n="difficulty.hard">困难</span>
                            <span class="players" data-i18n="players.1">1人</span>
                        </div>
                    </div>
                    <div class="game-card" data-game="2048" role="button" tabindex="0">
                        <div class="game-icon">🔢</div>
                        <h4 data-i18n="game.2048">2048</h4>
                        <p data-i18n="game.2048.desc">数字合并挑战</p>
                        <div class="game-meta">
                            <span class="difficulty medium" data-i18n="difficulty.medium">中等</span>
                            <span class="players" data-i18n="players.1">1人</span>
                        </div>
                    </div>
                    <div class="game-card" data-game="chess" role="button" tabindex="0">
                        <div class="game-icon">♟️</div>
                        <h4 data-i18n="game.chess">国际象棋</h4>
                        <p data-i18n="game.chess.desc">策略对战游戏</p>
                        <div class="game-meta">
                            <span class="difficulty hard" data-i18n="difficulty.hard">困难</span>
                            <span class="players" data-i18n="players.2">2人</span>
                        </div>
                    </div>
                    <div class="game-card" data-game="checkers" role="button" tabindex="0">
                        <div class="game-icon">⚪</div>
                        <h4 data-i18n="game.checkers">跳棋</h4>
                        <p data-i18n="game.checkers.desc">经典双人对战</p>
                        <div class="game-meta">
                            <span class="difficulty medium" data-i18n="difficulty.medium">中等</span>
                            <span class="players" data-i18n="players.2">2人</span>
                        </div>
                    </div>
                    <div class="game-card" data-game="tic-tac-toe" role="button" tabindex="0">
                        <div class="game-icon">❌</div>
                        <h4 data-i18n="game.tic-tac-toe">井字棋</h4>
                        <p data-i18n="game.tic-tac-toe.desc">经典策略游戏</p>
                        <div class="game-meta">
                            <span class="difficulty easy" data-i18n="difficulty.easy">简单</span>
                            <span class="players" data-i18n="players.2">2人</span>
                        </div>
                    </div>
                    <div class="game-card" data-game="memory-card" role="button" tabindex="0">
                        <div class="game-icon">🃏</div>
                        <h4 data-i18n="game.memory-card">记忆卡牌</h4>
                        <p data-i18n="game.memory-card.desc">考验记忆能力</p>
                        <div class="game-meta">
                            <span class="difficulty medium" data-i18n="difficulty.medium">中等</span>
                            <span class="players" data-i18n="players.1">1人</span>
                        </div>
                    </div>
                    <div class="game-card" data-game="arkanoid" role="button" tabindex="0">
                        <div class="game-icon">⚾</div>
                        <h4 data-i18n="game.arkanoid">打砖块</h4>
                        <p data-i18n="game.arkanoid.desc">经典街机游戏</p>
                        <div class="game-meta">
                            <span class="difficulty medium" data-i18n="difficulty.medium">中等</span>
                            <span class="players" data-i18n="players.1">1人</span>
                        </div>
                    </div>
                    <div class="game-card" data-game="spider-solitaire" role="button" tabindex="0">
                        <div class="game-icon">🕷️</div>
                        <h4 data-i18n="game.spider-solitaire">蜘蛛卡牌</h4>
                        <p data-i18n="game.spider-solitaire.desc">经典纸牌游戏</p>
                        <div class="game-meta">
                            <span class="difficulty hard" data-i18n="difficulty.hard">困难</span>
                            <span class="players" data-i18n="players.1">1人</span>
                        </div>
                    </div>
                    <div class="game-card" data-game="tank-battle" role="button" tabindex="0">
                        <div class="game-icon">🎖️</div>
                        <h4 data-i18n="game.tank-battle">坦克对战</h4>
                        <p data-i18n="game.tank-battle.desc">多人对战游戏</p>
                        <div class="game-meta">
                            <span class="difficulty medium" data-i18n="difficulty.medium">中等</span>
                            <span class="players" data-i18n="players.2">2人</span>
                        </div>
                    </div>
                    <div class="game-card" data-game="tank-battle-phaser" role="button" tabindex="0">
                        <div class="game-icon">🚀</div>
                        <h4>坦克大战</h4>
                        <p>现代化坦克对战游戏</p>
                        <div class="game-meta">
                            <span class="difficulty medium">中等</span>
                            <span class="players">2人</span>
                        </div>
                    </div>
                </div>
                                </section>

            <section class="features">
                <div class="feature-card">
                    <div class="feature-icon">🎮</div>
                    <h3 data-i18n="feature.richGames">丰富游戏</h3>
                    <p data-i18n="feature.richGames.desc">涵盖各类经典游戏，满足不同玩家的喜好</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">📱</div>
                    <h3 data-i18n="feature.responsive">响应式设计</h3>
                    <p data-i18n="feature.responsive.desc">完美适配桌面、平板和手机设备</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">⭐</div>
                    <h3 data-i18n="feature.updates">持续更新</h3>
                    <p data-i18n="feature.updates.desc">定期添加新游戏，保持新鲜感</p>
                </div>
            </section>

            <!-- 排行榜部分 -->
            <section class="leaderboard-section" id="leaderboard">
                <h3 data-i18n="section.leaderboard">排行榜</h3>
                <div class="leaderboard-container">
                    <table class="leaderboard-table">
                        <thead>
                            <tr>
                                <th data-i18n="leaderboard.rank">排名</th>
                                <th data-i18n="leaderboard.player">玩家</th>
                                <th data-i18n="leaderboard.score">分数</th>
                                <th data-i18n="leaderboard.game">游戏</th>
                                <th data-i18n="leaderboard.date">日期</th>
                            </tr>
                        </thead>
                        <tbody id="leaderboard-body">
                            <!-- 排行榜数据将通过JavaScript动态加载 -->
                        </tbody>
                    </table>
                    <div class="leaderboard-loading" id="leaderboard-loading">
                        <p data-i18n="leaderboard.loading">正在加载排行榜...</p>
                    </div>
                    <div class="leaderboard-empty" id="leaderboard-empty" style="display: none;">
                        <p data-i18n="leaderboard.empty">暂无排行榜数据</p>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- 排行榜提交模态框 -->
    <div id="score-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-i18n="modal.submitScore">提交分数</h3>
                <span class="modal-close" id="score-modal-close">&times;</span>
            </div>
            <div class="modal-body">
                <p data-i18n="modal.yourScore">您的分数: <span id="current-score">0</span></p>
                <p data-i18n="modal.game">游戏: <span id="current-game">未知</span></p>
                <div class="form-group">
                    <label for="player-name" data-i18n="modal.playerName">请输入您的昵称:</label>
                    <input type="text" id="player-name" maxlength="20" data-i18n-placeholder="modal.placeholder" placeholder="输入昵称">
                </div>
                <div class="modal-actions">
                    <button id="submit-score-btn" class="btn-primary" data-i18n="modal.submit">提交分数</button>
                    <button id="cancel-score-btn" class="btn-secondary" data-i18n="modal.cancel">取消</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 俄语公告模态框 -->
    <div id="russian-notice-modal" class="modal-overlay russian-notice-modal" style="display: none;">
        <div class="modal-content russian-notice-content">
            <div class="modal-header russian-notice-header">
                <h3 data-i18n="russianNotice.title">重要公告</h3>
                <span class="modal-close" id="russian-notice-close">&times;</span>
            </div>
            <div class="modal-body russian-notice-body">
                <div class="notice-icon">📢</div>
                <p class="notice-text" data-i18n="russianNotice.content">
                    本网站与 woodcat.io 无任何关联。我们是一个独立的小游戏合集网站，与其他任何使用类似名称的网站无关。
                </p>
                <div class="notice-highlight">
                    <span data-i18n="russianNotice.highlight">请勿混淆</span>
                </div>
            </div>
            <div class="modal-footer russian-notice-footer">
                <button id="russian-notice-confirm" class="btn-primary" data-i18n="russianNotice.confirm">我明白了</button>
            </div>
        </div>
    </div>

    <script type="module"  src="js/logger.js" defer></script>
    <script type="module"  src="js/cdnManager.js" defer></script>
    <script type="module"  src="js/lib/hammer.min.js" defer></script>
    <script type="module"  src="js/audioVibration.js" defer></script>
    <script type="module"  src="js/dataManager.js" defer></script>
    <script type="module"  src="js/scoreManager.js" defer></script>
    <script type="module"  src="js/modal.js" defer></script>
    <script type="module"  src="js/i18n.js" defer></script>
    <script>
        // 语言切换功能
        function initLanguageSwitcher() {
            const langToggle = document.getElementById('langToggle');

            // 语言切换事件
            if (langToggle) {
                // 移除可能存在的旧事件监听器
                const newLangToggle = langToggle.cloneNode(true);
                langToggle.parentNode.replaceChild(newLangToggle, langToggle);
                
                // 获取新按钮中的langText元素
                const langText = newLangToggle.querySelector('#langText');

                // 更新语言按钮显示
                function updateLangButton() {
                    if (window.i18n) {
                        try {
                            const currentLang = window.i18n.getCurrentLanguage();
                            langText.textContent = currentLang === 'zh-CN' ? 'RU' : '中文';
                        } catch (error) {
                            console.error('更新语言按钮显示时出错:', error);
                        }
                    } else {
                        console.warn('i18n对象未初始化');
                        // 设置默认值
                        langText.textContent = 'RU';
                    }
                }
                
                // 添加新的事件监听器
                newLangToggle.addEventListener('click', function() {
                    if (window.i18n) {
                        try {
                            const currentLang = window.i18n.getCurrentLanguage();
                            const newLang = currentLang === 'zh-CN' ? 'ru' : 'zh-CN';
                            console.log('切换语言:', currentLang, '->', newLang);
                            window.i18n.setLanguage(newLang);
                            updateLangButton();
                        } catch (error) {
                            console.error('切换语言时出错:', error);
                        }
                    } else {
                        console.warn('i18n对象未初始化，无法切换语言');
                    }
                });

                // 初始化语言按钮
                updateLangButton();
            }
        }

        // 等待i18n对象初始化的函数
        function waitForI18n() {
            let attempts = 0;
            const maxAttempts = 10;
            const interval = 200;

            function checkI18n() {
                attempts++;
                if (window.i18n) {
                    initLanguageSwitcher();
                } else if (attempts < maxAttempts) {
                    setTimeout(checkI18n, interval);
                } else {
                    console.warn('i18n对象初始化超时，使用默认语言设置');
                    initLanguageSwitcher(); // 即使i18n未初始化也执行，设置默认值
                }
            }

            checkI18n();
        }

        // 确保在DOM加载完成后初始化语言切换器
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                // 等待i18n对象初始化完成
                waitForI18n();
            });
        } else {
            // 立即初始化语言切换器
            waitForI18n();
        }
    </script>
    <script type="module"  src="js/main.js" defer></script>
    <script type="module"  src="js/cdnLoader.js" defer></script>
    <!-- 滚动效果脚本 -->
    <script>
        // 添加滚动效果
        window.addEventListener('scroll', function() {
            const header = document.querySelector('.header');
            if (header) {
                if (window.scrollY > 50) {
                    header.classList.add('scrolled');
                } else {
                    header.classList.remove('scrolled');
                }
            }
        });
        
        // 移动端菜单按钮状态切换
        const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
        const navUl = document.querySelector('.nav ul');
        
        if (mobileMenuBtn && navUl) {
            mobileMenuBtn.addEventListener('click', function() {
                this.classList.toggle('active');
                if (navUl.style.display === 'flex') {
                    navUl.style.display = 'none';
                } else {
                    navUl.style.display = 'flex';
                }
            });
            
            // 点击菜单外部关闭菜单
            document.addEventListener('click', function(e) {
                if (!mobileMenuBtn.contains(e.target) && !navUl.contains(e.target)) {
                    mobileMenuBtn.classList.remove('active');
                    navUl.style.display = 'none';
                }
            });
        }
    </script>
    <!-- 排行榜相关脚本（动态加载） -->
    <!-- 使用cdnLoader.js覆盖默认的配置和Supabase库加载方式 -->

    <!-- PWA添加引导模态框 -->
    <div class="modal-overlay" id="pwa-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>添加到主屏幕</h3>
                <button class="modal-close" id="pwa-modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p>您已经游玩了多个游戏，是否将木头猫游戏合集添加到主屏幕，以便更方便地访问？</p>
            </div>
            <div class="modal-actions">
                <button class="btn-primary" id="pwa-yes">是</button>
                <button class="btn-secondary" id="pwa-no">否</button>
            </div>
        </div>
    </div>

    <!-- 设备类型选择模态框 -->
    <div class="modal-overlay" id="device-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>选择设备类型</h3>
                <button class="modal-close" id="device-modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p>请选择您的设备类型，我们将为您提供相应的添加引导：</p>
                <div style="display: flex; gap: 20px; justify-content: center; margin-top: 20px;">
                    <button class="btn-primary" style="padding: 20px;" id="device-iphone">iPhone/iPad</button>
                    <button class="btn-primary" style="padding: 20px;" id="device-android">Android</button>
                    <button class="btn-primary" style="padding: 20px;" id="device-desktop">桌面端</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 添加引导模态框 -->
    <div class="modal-overlay" id="guide-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>添加到主屏幕引导</h3>
                <button class="modal-close" id="guide-modal-close">&times;</button>
            </div>
            <div class="modal-body" id="guide-content">
                <!-- 引导内容将通过JavaScript动态添加 -->
            </div>
            <div class="modal-actions">
                <button class="btn-primary" id="guide-close">我知道了</button>
            </div>
        </div>
    </div>

    <!-- 版权声明 -->
    <div class="copyright-notice">
        <p data-i18n="copyright">&copy; 2026 木头猫 - 保留所有权利</p>
    </div>

    <!-- Service Worker Registration -->
    <script>
        // Register Service Worker for PWA functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(function(registration) {
                        console.log('Service Worker registered with scope:', registration.scope);
                    })
                    .catch(function(error) {
                        console.error('Service Worker registration failed:', error);
                    });
            });
        }

        // Check for PWA installation capability
        let deferredPrompt;
        const addBtn = document.createElement('button');
        addBtn.style.display = 'none';
        document.body.appendChild(addBtn);

        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent Chrome 67 and earlier from automatically showing the prompt
            e.preventDefault();
            // Stash the event so it can be triggered later
            deferredPrompt = e;
            // Update UI to notify the user they can add to home screen
            addBtn.style.display = 'block';
            addBtn.textContent = '添加到主屏幕';
            addBtn.addEventListener('click', () => {
                // Show the install prompt
                deferredPrompt.prompt();
                // Wait for the user to respond to the prompt
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the A2HS prompt');
                    } else {
                        console.log('User dismissed the A2HS prompt');
                    }
                    deferredPrompt = null;
                    addBtn.style.display = 'none';
                });
            });
        });

        // Listen for app installed event
        window.addEventListener('appinstalled', (evt) => {
            console.log('App installed successfully!');
            addBtn.style.display = 'none';
        });
    </script>
</body>
</html>