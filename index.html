<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æœ¨å¤´çŒ« - å°æ¸¸æˆåˆé›†</title>
    <!-- PWA Meta Tags -->
    <meta name="description" content="æœ¨å¤´çŒ«æ¸¸æˆåˆé›† - è½»æ¾æ„‰å¿«çš„æ¸¸æˆæ—¶å…‰ï¼Œæä¾›å¤šç§ç»å…¸ä¼‘é—²æ¸¸æˆä¾›æ‚¨é€‰æ‹©">
    <meta name="keywords" content="æ¸¸æˆ,ä¼‘é—²æ¸¸æˆ,æœ¨å¤´çŒ«,ä¿„ç½—æ–¯æ–¹å—,è´ªåƒè›‡,æ‰«é›·,2048,åœ¨çº¿æ¸¸æˆ">
    <meta name="theme-color" content="#3498db">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="æœ¨å¤´çŒ«æ¸¸æˆ">
    <meta name="application-name" content="æœ¨å¤´çŒ«æ¸¸æˆåˆé›†">
    <meta name="msapplication-TileColor" content="#3498db">
    <meta name="msapplication-config" content="/browserconfig.xml">
    <!-- Favicon and Icons -->
    <link rel="icon" type="image/x-icon" href="/icons/favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/icons/favicon-96x96.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <link rel="mask-icon" href="/icons/favicon.svg" color="#3498db">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="preload" href="css/style.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&family=Noto+Sans:wght@300;400;500;700&display=swap" rel="stylesheet">
    <noscript><link rel="stylesheet" href="css/style.css"></noscript>
    <style>
        /* æ— éšœç¢ç„¦ç‚¹æ ·å¼ */
        :focus-visible {
            outline: 2px solid #3498db;
            outline-offset: 2px;
        }
        
        /* å‡å°‘åŠ¨ç”»å¯¹äº prefers-reduced-motion çš„ç”¨æˆ· */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }
        
        /* ç¡®ä¿è¶³å¤Ÿçš„é¢œè‰²å¯¹æ¯”åº¦ */
        .game-card h4,
        .feature-card h3,
        .hero h2 {
            color: #2c3e50;
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loading-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }
        .loading-animation.hidden {
            opacity: 0;
            visibility: hidden;
        }
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- åŠ è½½åŠ¨ç”» -->
    <div class="loading-animation" id="loadingAnimation">
        <div class="loading-spinner" aria-hidden="true"></div>
        <span class="sr-only">é¡µé¢åŠ è½½ä¸­</span>
    </div>

    <div class="container">
        <!-- å¤´éƒ¨ -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <h1 data-i18n="site.title">æœ¨å¤´çŒ«</h1>
                    <p class="slogan" data-i18n="site.slogan">å‘ç°æœ‰è¶£çš„å°æ¸¸æˆ</p>
                </div>
                <div class="nav-container">
                    <nav class="nav" aria-label="ä¸»å¯¼èˆª">
                        <ul>
                            <li><a href="#" class="active" aria-current="page" data-i18n="nav.home">é¦–é¡µ</a></li>
                            <li><a href="#games" data-i18n="nav.games">æ¸¸æˆ</a></li>
                            <li><a href="leaderboard.html" data-i18n="nav.leaderboard">æ’è¡Œæ¦œ</a></li>
                            <li class="lang-switcher">
                                <button type="button" class="lang-btn" id="langToggle" aria-expanded="false" aria-controls="langMenu" aria-label="åˆ‡æ¢è¯­è¨€">
                                    <span id="langIcon" aria-hidden="true">ğŸŒ</span>
                                    <span id="langText">RU</span>
                                </button>
                            </li>
                        </ul>
                    </nav>
                    <button type="button" class="mobile-menu-btn" aria-expanded="false" aria-controls="nav" aria-label="æ‰“å¼€èœå•">
                        <span aria-hidden="true"></span>
                        <span aria-hidden="true"></span>
                        <span aria-hidden="true"></span>
                    </button>
                </div>
            </div>
        </header>

        <!-- ä¸»è¦å†…å®¹ -->
        <main class="main">
            <section class="hero" aria-labelledby="hero-title">
                <h2 id="hero-title" data-i18n="hero.title">æ¬¢è¿æ¥åˆ°æœ¨å¤´çŒ«æ¸¸æˆä¸–ç•Œ</h2>
                <p data-i18n="hero.description">åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°å„ç§ç»å…¸æœ‰è¶£çš„å°æ¸¸æˆï¼Œéšæ—¶éšåœ°äº«å—æ¸¸æˆçš„ä¹è¶£ã€‚</p>
                <div class="cta-buttons">
                    <button type="button" class="btn-primary" onclick="startRandomGame()" data-i18n="hero.startGame" aria-label="å¼€å§‹éšæœºæ¸¸æˆ">å¼€å§‹æ¸¸æˆ</button>
                </div>
            </section>

            <section class="games-section" id="games" aria-labelledby="games-title">
                <h3 id="games-title" data-i18n="section.games">ç²¾é€‰æ¸¸æˆ</h3>
                <div class="games-grid">
                    <button type="button" class="game-card" data-game="tetris" aria-label="ä¿„ç½—æ–¯æ–¹å— - ç»å…¸ç›Šæ™ºæ¸¸æˆ">
                        <span class="game-icon" aria-hidden="true">ğŸ§©</span>
                        <span data-i18n="game.tetris">ä¿„ç½—æ–¯æ–¹å—</span>
                        <span data-i18n="game.tetris.desc">ç»å…¸ç›Šæ™ºæ¸¸æˆ</span>
                        <span class="game-meta">
                            <span class="difficulty easy" data-i18n="difficulty.easy">ç®€å•</span>
                            <span class="players" data-i18n="players.1">1äºº</span>
                        </span>
                    </button>
                    <button type="button" class="game-card" data-game="snake" aria-label="è´ªåƒè›‡ - æ€€æ—§ç»å…¸ç©æ³•">
                        <span class="game-icon" aria-hidden="true">ğŸ</span>
                        <span data-i18n="game.snake">è´ªåƒè›‡</span>
                        <span data-i18n="game.snake.desc">æ€€æ—§ç»å…¸ç©æ³•</span>
                        <span class="game-meta">
                            <span class="difficulty medium" data-i18n="difficulty.medium">ä¸­ç­‰</span>
                            <span class="players" data-i18n="players.1">1äºº</span>
                        </span>
                    </button>
                    <button type="button" class="game-card" data-game="minesweeper" aria-label="æ‰«é›· - æŒ‘æˆ˜é€»è¾‘æ€ç»´">
                        <span class="game-icon" aria-hidden="true">ğŸ’£</span>
                        <span data-i18n="game.minesweeper">æ‰«é›·</span>
                        <span data-i18n="game.minesweeper.desc">æŒ‘æˆ˜é€»è¾‘æ€ç»´</span>
                        <span class="game-meta">
                            <span class="difficulty hard" data-i18n="difficulty.hard">å›°éš¾</span>
                            <span class="players" data-i18n="players.1">1äºº</span>
                        </span>
                    </button>
                    <button type="button" class="game-card" data-game="2048" aria-label="2048 - æ•°å­—åˆå¹¶æŒ‘æˆ˜">
                        <span class="game-icon" aria-hidden="true">ğŸ”¢</span>
                        <span data-i18n="game.2048">2048</span>
                        <span data-i18n="game.2048.desc">æ•°å­—åˆå¹¶æŒ‘æˆ˜</span>
                        <span class="game-meta">
                            <span class="difficulty medium" data-i18n="difficulty.medium">ä¸­ç­‰</span>
                            <span class="players" data-i18n="players.1">1äºº</span>
                        </span>
                    </button>
                    <button type="button" class="game-card" data-game="chess" aria-label="å›½é™…è±¡æ£‹ - ç­–ç•¥å¯¹æˆ˜æ¸¸æˆ">
                        <span class="game-icon" aria-hidden="true">â™Ÿï¸</span>
                        <span data-i18n="game.chess">å›½é™…è±¡æ£‹</span>
                        <span data-i18n="game.chess.desc">ç­–ç•¥å¯¹æˆ˜æ¸¸æˆ</span>
                        <span class="game-meta">
                            <span class="difficulty hard" data-i18n="difficulty.hard">å›°éš¾</span>
                            <span class="players" data-i18n="players.2">2äºº</span>
                        </span>
                    </button>
                    <button type="button" class="game-card" data-game="checkers" aria-label="è·³æ£‹ - ç»å…¸åŒäººå¯¹æˆ˜">
                        <span class="game-icon" aria-hidden="true">âšª</span>
                        <span data-i18n="game.checkers">è·³æ£‹</span>
                        <span data-i18n="game.checkers.desc">ç»å…¸åŒäººå¯¹æˆ˜</span>
                        <span class="game-meta">
                            <span class="difficulty medium" data-i18n="difficulty.medium">ä¸­ç­‰</span>
                            <span class="players" data-i18n="players.2">2äºº</span>
                        </span>
                    </button>
                    <button type="button" class="game-card" data-game="tic-tac-toe" aria-label="äº•å­—æ£‹ - ç»å…¸ç­–ç•¥æ¸¸æˆ">
                        <span class="game-icon" aria-hidden="true">âŒ</span>
                        <span data-i18n="game.tic-tac-toe">äº•å­—æ£‹</span>
                        <span data-i18n="game.tic-tac-toe.desc">ç»å…¸ç­–ç•¥æ¸¸æˆ</span>
                        <span class="game-meta">
                            <span class="difficulty easy" data-i18n="difficulty.easy">ç®€å•</span>
                            <span class="players" data-i18n="players.2">2äºº</span>
                        </span>
                    </button>
                    <button type="button" class="game-card" data-game="memory-card" aria-label="è®°å¿†å¡ç‰Œ - è€ƒéªŒè®°å¿†èƒ½åŠ›">
                        <span class="game-icon" aria-hidden="true">ğŸƒ</span>
                        <span data-i18n="game.memory-card">è®°å¿†å¡ç‰Œ</span>
                        <span data-i18n="game.memory-card.desc">è€ƒéªŒè®°å¿†èƒ½åŠ›</span>
                        <span class="game-meta">
                            <span class="difficulty medium" data-i18n="difficulty.medium">ä¸­ç­‰</span>
                            <span class="players" data-i18n="players.1">1äºº</span>
                        </span>
                    </button>
                    <button type="button" class="game-card" data-game="arkanoid" aria-label="æ‰“ç –å— - ç»å…¸è¡—æœºæ¸¸æˆ">
                        <span class="game-icon" aria-hidden="true">âš¾</span>
                        <span data-i18n="game.arkanoid">æ‰“ç –å—</span>
                        <span data-i18n="game.arkanoid.desc">ç»å…¸è¡—æœºæ¸¸æˆ</span>
                        <span class="game-meta">
                            <span class="difficulty medium" data-i18n="difficulty.medium">ä¸­ç­‰</span>
                            <span class="players" data-i18n="players.1">1äºº</span>
                        </span>
                    </button>
                    <button type="button" class="game-card" data-game="spider-solitaire" aria-label="èœ˜è››å¡ç‰Œ - ç»å…¸çº¸ç‰Œæ¸¸æˆ">
                        <span class="game-icon" aria-hidden="true">ğŸ•·ï¸</span>
                        <span data-i18n="game.spider-solitaire">èœ˜è››å¡ç‰Œ</span>
                        <span data-i18n="game.spider-solitaire.desc">ç»å…¸çº¸ç‰Œæ¸¸æˆ</span>
                        <span class="game-meta">
                            <span class="difficulty hard" data-i18n="difficulty.hard">å›°éš¾</span>
                            <span class="players" data-i18n="players.1">1äºº</span>
                        </span>
                    </button>
                    <button type="button" class="game-card" data-game="tank-battle" aria-label="å¦å…‹å¯¹æˆ˜ - å¤šäººå¯¹æˆ˜æ¸¸æˆ">
                        <span class="game-icon" aria-hidden="true">ğŸ–ï¸</span>
                        <span data-i18n="game.tank-battle">å¦å…‹å¯¹æˆ˜</span>
                        <span data-i18n="game.tank-battle.desc">å¤šäººå¯¹æˆ˜æ¸¸æˆ</span>
                        <span class="game-meta">
                            <span class="difficulty medium" data-i18n="difficulty.medium">ä¸­ç­‰</span>
                            <span class="players" data-i18n="players.2">2äºº</span>
                        </span>
                    </button>
                </div>
            </section>

            <section class="features" aria-labelledby="features-title">
                <h3 id="features-title" class="sr-only">ç½‘ç«™ç‰¹è‰²</h3>
                <aside class="feature-card" aria-label="ä¸°å¯Œæ¸¸æˆ">
                    <div class="feature-icon" aria-hidden="true">ğŸ®</div>
                    <h3 data-i18n="feature.richGames">ä¸°å¯Œæ¸¸æˆ</h3>
                    <p data-i18n="feature.richGames.desc">æ¶µç›–å„ç±»ç»å…¸æ¸¸æˆï¼Œæ»¡è¶³ä¸åŒç©å®¶çš„å–œå¥½</p>
                </aside>
                <aside class="feature-card" aria-label="å“åº”å¼è®¾è®¡">
                    <div class="feature-icon" aria-hidden="true">ğŸ“±</div>
                    <h3 data-i18n="feature.responsive">å“åº”å¼è®¾è®¡</h3>
                    <p data-i18n="feature.responsive.desc">å®Œç¾é€‚é…æ¡Œé¢ã€å¹³æ¿å’Œæ‰‹æœºè®¾å¤‡</p>
                </aside>
                <aside class="feature-card" aria-label="æŒç»­æ›´æ–°">
                    <div class="feature-icon" aria-hidden="true">â­</div>
                    <h3 data-i18n="feature.updates">æŒç»­æ›´æ–°</h3>
                    <p data-i18n="feature.updates.desc">å®šæœŸæ·»åŠ æ–°æ¸¸æˆï¼Œä¿æŒæ–°é²œæ„Ÿ</p>
                </aside>
            </section>

            <!-- æ’è¡Œæ¦œéƒ¨åˆ† -->
            <section class="leaderboard-section" id="leaderboard" aria-labelledby="leaderboard-title">
                <h3 id="leaderboard-title" data-i18n="section.leaderboard">æ’è¡Œæ¦œ</h3>
                <div class="leaderboard-container">
                    <table class="leaderboard-table" aria-label="æ¸¸æˆæ’è¡Œæ¦œ">
                        <thead>
                            <tr>
                                <th scope="col" data-i18n="leaderboard.rank">æ’å</th>
                                <th scope="col" data-i18n="leaderboard.player">ç©å®¶</th>
                                <th scope="col" data-i18n="leaderboard.score">åˆ†æ•°</th>
                                <th scope="col" data-i18n="leaderboard.game">æ¸¸æˆ</th>
                                <th scope="col" data-i18n="leaderboard.date">æ—¥æœŸ</th>
                            </tr>
                        </thead>
                        <tbody id="leaderboard-body">
                            <!-- æ’è¡Œæ¦œæ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                        </tbody>
                    </table>
                    <div class="leaderboard-loading" id="leaderboard-loading" aria-live="polite">
                        <p data-i18n="leaderboard.loading">æ­£åœ¨åŠ è½½æ’è¡Œæ¦œ...</p>
                    </div>
                    <div class="leaderboard-empty" id="leaderboard-empty" aria-live="polite">
                        <p data-i18n="leaderboard.empty">æš‚æ— æ’è¡Œæ¦œæ•°æ®</p>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- æ’è¡Œæ¦œæäº¤æ¨¡æ€æ¡† -->
    <div id="score-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-i18n="modal.submitScore">æäº¤åˆ†æ•°</h3>
                <button type="button" class="modal-close" id="score-modal-close" aria-label="å…³é—­">&times;</button>
            </div>
            <div class="modal-body">
                <p data-i18n="modal.yourScore">æ‚¨çš„åˆ†æ•°: <span id="current-score">0</span></p>
                <p data-i18n="modal.game">æ¸¸æˆ: <span id="current-game">æœªçŸ¥</span></p>
                <div class="form-group">
                    <label for="player-name" data-i18n="modal.playerName">è¯·è¾“å…¥æ‚¨çš„æ˜µç§°:</label>
                    <input type="text" id="player-name" maxlength="20" data-i18n-placeholder="modal.placeholder" placeholder="è¾“å…¥æ˜µç§°">
                </div>
                <div class="modal-actions">
                    <button type="button" id="submit-score-btn" class="btn-primary" data-i18n="modal.submit">æäº¤åˆ†æ•°</button>
                    <button type="button" id="cancel-score-btn" class="btn-secondary" data-i18n="modal.cancel">å–æ¶ˆ</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¿„è¯­å…¬å‘Šæ¨¡æ€æ¡† -->
    <div id="russian-notice-modal" class="modal-overlay russian-notice-modal">
        <div class="modal-content russian-notice-content">
            <div class="modal-header russian-notice-header">
                <h3 data-i18n="russianNotice.title">é‡è¦å…¬å‘Š</h3>
                <button type="button" class="modal-close" id="russian-notice-close" aria-label="å…³é—­">&times;</button>
            </div>
            <div class="modal-body russian-notice-body">
                <div class="notice-icon" aria-hidden="true">ğŸ“¢</div>
                <p class="notice-text" data-i18n="russianNotice.content">
                    æœ¬ç½‘ç«™ä¸ woodcat.io æ— ä»»ä½•å…³è”ã€‚æˆ‘ä»¬æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å°æ¸¸æˆåˆé›†ç½‘ç«™ï¼Œä¸å…¶ä»–ä»»ä½•ä½¿ç”¨ç±»ä¼¼åç§°çš„ç½‘ç«™æ— å…³ã€‚
                </p>
                <div class="notice-highlight">
                    <span data-i18n="russianNotice.highlight">è¯·å‹¿æ··æ·†</span>
                </div>
            </div>
            <div class="modal-footer russian-notice-footer">
                <button type="button" id="russian-notice-confirm" class="btn-primary" data-i18n="russianNotice.confirm">æˆ‘æ˜ç™½äº†</button>
            </div>
        </div>
    </div>

    <script src="js/logger.js" defer></script>
    <script src="js/cdnManager.js" defer></script>
    <script src="js/lib/hammer.min.js" defer></script>
    <script src="js/audioVibration.js" defer></script>
    <script src="js/dataManager.js" defer></script>
    <script src="js/scoreManager.js" defer></script>
    <script src="js/modal.js" defer></script>
    <script src="js/i18n.js" defer></script>
    <script>
        // è¯­è¨€åˆ‡æ¢åŠŸèƒ½
        function initLanguageSwitcher() {
            const langToggle = document.getElementById('langToggle');

            // è¯­è¨€åˆ‡æ¢äº‹ä»¶
            if (langToggle) {
                // ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§äº‹ä»¶ç›‘å¬å™¨
                const newLangToggle = langToggle.cloneNode(true);
                langToggle.parentNode.replaceChild(newLangToggle, langToggle);
                
                // è·å–æ–°æŒ‰é’®ä¸­çš„langTextå…ƒç´ 
                const langText = newLangToggle.querySelector('#langText');

                // æ›´æ–°è¯­è¨€æŒ‰é’®æ˜¾ç¤º
                function updateLangButton() {
                    if (window.i18n) {
                        try {
                            const currentLang = window.i18n.getCurrentLanguage();
                            langText.textContent = currentLang === 'zh-CN' ? 'RU' : 'ä¸­æ–‡';
                        } catch (error) {
                            console.error('æ›´æ–°è¯­è¨€æŒ‰é’®æ˜¾ç¤ºæ—¶å‡ºé”™:', error);
                        }
                    } else {
                        console.warn('i18nå¯¹è±¡æœªåˆå§‹åŒ–');
                        // è®¾ç½®é»˜è®¤å€¼
                        langText.textContent = 'RU';
                    }
                }
                
                // æ·»åŠ æ–°çš„äº‹ä»¶ç›‘å¬å™¨
                newLangToggle.addEventListener('click', function() {
                    if (window.i18n) {
                        try {
                            const currentLang = window.i18n.getCurrentLanguage();
                            const newLang = currentLang === 'zh-CN' ? 'ru' : 'zh-CN';
                            console.log('åˆ‡æ¢è¯­è¨€:', currentLang, '->', newLang);
                            window.i18n.setLanguage(newLang);
                            updateLangButton();
                        } catch (error) {
                            console.error('åˆ‡æ¢è¯­è¨€æ—¶å‡ºé”™:', error);
                        }
                    } else {
                        console.warn('i18nå¯¹è±¡æœªåˆå§‹åŒ–ï¼Œæ— æ³•åˆ‡æ¢è¯­è¨€');
                    }
                });

                // åˆå§‹åŒ–è¯­è¨€æŒ‰é’®
                updateLangButton();
            }
        }

        // ç­‰å¾…i18nå¯¹è±¡åˆå§‹åŒ–çš„å‡½æ•°
        function waitForI18n() {
            let attempts = 0;
            const maxAttempts = 10;
            const interval = 200;

            function checkI18n() {
                attempts++;
                if (window.i18n) {
                    initLanguageSwitcher();
                } else if (attempts < maxAttempts) {
                    setTimeout(checkI18n, interval);
                } else {
                    console.warn('i18nå¯¹è±¡åˆå§‹åŒ–è¶…æ—¶ï¼Œä½¿ç”¨é»˜è®¤è¯­è¨€è®¾ç½®');
                    initLanguageSwitcher(); // å³ä½¿i18næœªåˆå§‹åŒ–ä¹Ÿæ‰§è¡Œï¼Œè®¾ç½®é»˜è®¤å€¼
                }
            }

            checkI18n();
        }

        // ç¡®ä¿åœ¨DOMåŠ è½½å®Œæˆååˆå§‹åŒ–è¯­è¨€åˆ‡æ¢å™¨
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                // ç­‰å¾…i18nå¯¹è±¡åˆå§‹åŒ–å®Œæˆ
                waitForI18n();
            });
        } else {
            // ç«‹å³åˆå§‹åŒ–è¯­è¨€åˆ‡æ¢å™¨
            waitForI18n();
        }
    </script>
    <script src="js/main.js" defer></script>
    <script src="js/cdnLoader.js" defer></script>
    <!-- æ»šåŠ¨æ•ˆæœè„šæœ¬ -->
    <script>
        // æ·»åŠ æ»šåŠ¨æ•ˆæœ
        window.addEventListener('scroll', function() {
            const header = document.querySelector('.header');
            if (header) {
                if (window.scrollY > 50) {
                    header.classList.add('scrolled');
                } else {
                    header.classList.remove('scrolled');
                }
            }
        });
        
        // ç§»åŠ¨ç«¯èœå•æŒ‰é’®çŠ¶æ€åˆ‡æ¢
        const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
        const navUl = document.querySelector('.nav ul');
        
        if (mobileMenuBtn && navUl) {
            mobileMenuBtn.addEventListener('click', function() {
                this.classList.toggle('active');
                if (navUl.style.display === 'flex') {
                    navUl.style.display = 'none';
                } else {
                    navUl.style.display = 'flex';
                }
            });
            
            // ç‚¹å‡»èœå•å¤–éƒ¨å…³é—­èœå•
            document.addEventListener('click', function(e) {
                if (!mobileMenuBtn.contains(e.target) && !navUl.contains(e.target)) {
                    mobileMenuBtn.classList.remove('active');
                    navUl.style.display = 'none';
                }
            });
        }
    </script>
    <!-- æ’è¡Œæ¦œç›¸å…³è„šæœ¬ï¼ˆåŠ¨æ€åŠ è½½ï¼‰ -->
    <!-- ä½¿ç”¨cdnLoader.jsè¦†ç›–é»˜è®¤çš„é…ç½®å’ŒSupabaseåº“åŠ è½½æ–¹å¼ -->

    <!-- PWAæ·»åŠ å¼•å¯¼æ¨¡æ€æ¡† -->
    <div class="modal-overlay" id="pwa-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>æ·»åŠ åˆ°ä¸»å±å¹•</h3>
                <button type="button" class="modal-close" id="pwa-modal-close" aria-label="å…³é—­">&times;</button>
            </div>
            <div class="modal-body">
                <p>æ‚¨å·²ç»æ¸¸ç©äº†å¤šä¸ªæ¸¸æˆï¼Œæ˜¯å¦å°†æœ¨å¤´çŒ«æ¸¸æˆåˆé›†æ·»åŠ åˆ°ä¸»å±å¹•ï¼Œä»¥ä¾¿æ›´æ–¹ä¾¿åœ°è®¿é—®ï¼Ÿ</p>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn-primary" id="pwa-yes">æ˜¯</button>
                <button type="button" class="btn-secondary" id="pwa-no">å¦</button>
            </div>
        </div>
    </div>

    <!-- è®¾å¤‡ç±»å‹é€‰æ‹©æ¨¡æ€æ¡† -->
    <div class="modal-overlay" id="device-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>é€‰æ‹©è®¾å¤‡ç±»å‹</h3>
                <button type="button" class="modal-close" id="device-modal-close" aria-label="å…³é—­">&times;</button>
            </div>
            <div class="modal-body">
                <p>è¯·é€‰æ‹©æ‚¨çš„è®¾å¤‡ç±»å‹ï¼Œæˆ‘ä»¬å°†ä¸ºæ‚¨æä¾›ç›¸åº”çš„æ·»åŠ å¼•å¯¼ï¼š</p>
                <div class="device-buttons">
                    <button type="button" class="btn-primary" id="device-iphone">iPhone/iPad</button>
                    <button type="button" class="btn-primary" id="device-android">Android</button>
                    <button type="button" class="btn-primary" id="device-desktop">æ¡Œé¢ç«¯</button>
                </div>
            </div>
        </div>
    </div>

    <!-- æ·»åŠ å¼•å¯¼æ¨¡æ€æ¡† -->
    <div class="modal-overlay" id="guide-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>æ·»åŠ åˆ°ä¸»å±å¹•å¼•å¯¼</h3>
                <button type="button" class="modal-close" id="guide-modal-close" aria-label="å…³é—­">&times;</button>
            </div>
            <div class="modal-body" id="guide-content">
                <!-- å¼•å¯¼å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
            </div>
            <div class="modal-actions">
                <button type="button" class="btn-primary" id="guide-close">æˆ‘çŸ¥é“äº†</button>
            </div>
        </div>
    </div>

    <!-- ç‰ˆæƒå£°æ˜ -->
    <div class="copyright-notice">
        <p data-i18n="copyright">&copy; 2026 æœ¨å¤´çŒ« - ä¿ç•™æ‰€æœ‰æƒåˆ©</p>
    </div>

    <!-- Service Worker Registration -->
    <script>
        // Register Service Worker for PWA functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(function(registration) {
                        console.log('Service Worker registered with scope:', registration.scope);
                    })
                    .catch(function(error) {
                        console.error('Service Worker registration failed:', error);
                    });
            });
        }

        // Check for PWA installation capability
        let deferredPrompt;
        const addBtn = document.createElement('button');
        addBtn.style.display = 'none';
        document.body.appendChild(addBtn);

        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent Chrome 67 and earlier from automatically showing the prompt
            e.preventDefault();
            // Stash the event so it can be triggered later
            deferredPrompt = e;
            // Update UI to notify the user they can add to home screen
            addBtn.style.display = 'block';
            addBtn.textContent = 'æ·»åŠ åˆ°ä¸»å±å¹•';
            addBtn.addEventListener('click', () => {
                // Show the install prompt
                deferredPrompt.prompt();
                // Wait for the user to respond to the prompt
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the A2HS prompt');
                    } else {
                        console.log('User dismissed the A2HS prompt');
                    }
                    deferredPrompt = null;
                    addBtn.style.display = 'none';
                });
            });
        });

        // Listen for app installed event
        window.addEventListener('appinstalled', (evt) => {
            console.log('App installed successfully!');
            addBtn.style.display = 'none';
        });
    </script>
</body>
</html>